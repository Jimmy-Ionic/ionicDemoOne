!function(){"use strict";function e(e,t,a,o,n,i,s,r){function c(){i.goBack()}function l(){s.go("recMessage")}a.unReadMsgCount=0,a.goBack=c,a.toMessagePage=l,r.setServerInfo()}function t(e,t,a,o,n){a.ready(function(){if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),window.codePush){var t;e.downloadMsg="";var a=function(e){t.close(),n.alert({title:"更新提示",template:"更新失败！"})},o=function(){t.close(),n.alert({title:"更新提示",template:"更新成功！"}).then(function(){codePush.restartApplication()})},i=function(e){return(e/1024).toFixed(2)},s=function(t){e.downloadMsg=i(t.receivedBytes)+"kb 共"+i(t.totalBytes)+"kb"},r=function(e){e.install(o,a,{installMode:InstallMode.ON_NEXT_RESUME,minimumBackgroundDuration:120,mandatoryInstallMode:InstallMode.ON_NEXT_RESTART})},c=function(o){o&&!o.failedInstall&&n.confirm({title:"更新提示",template:"有可用的新版本，是否需要更新？",cancelText:"否",okText:"是"}).then(function(i){i&&(t=n.show({template:"<span>正在下载 {{downloadMsg}}</span>",scope:e,title:"更新提示"}),o.download(r,a,s))})};window.codePush.checkForUpdate(c,a)}}),a.registerBackButtonAction(function(a){function i(){var t=n.show({title:"提示",subTitle:"你确定要退出应用吗？",scope:e,buttons:[{text:"取消",type:"button-clear button-assertive",onTap:function(){return"cancel"}},{text:"确认",type:"button-clear button-positive border-left",onTap:function(e){return"active"}}]});t.then(function(e){"active"==e&&ionic.Platform.exitApp()})}a.preventDefault();var s=t.path();return"/home"===s||"/login"===s?i():o.backView?o.goBack():i(),!1},101)}function a(e,t,a){a.platform.ios.tabs.style("standard"),a.platform.ios.tabs.position("bottom"),a.platform.android.tabs.style("standard"),a.platform.android.tabs.position("standard"),a.platform.ios.navBar.alignTitle("center"),a.platform.android.navBar.alignTitle("left"),a.platform.ios.backButton.previousTitleText("").icon("ion-ios-arrow-thin-left"),a.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),a.platform.ios.views.transition("ios"),a.platform.android.views.transition("android"),t.otherwise("/login")}a.$inject=["$stateProvider","$urlRouterProvider","$ionicConfigProvider"],e.$inject=["$scope","SYS_INFO","$rootScope","$interval","$http","$ionicHistory","$state","LoginService"],angular.module("app",["ionic","ngStorage","ngFileUpload","ng-echarts","ngCordova","app.login","app.home","app.savedData","app.waitForWork","app.assessment","app.planDetails","app.assessmentStatus","app.assessmentStatusDetails","app.addAssessment","app.addAssessmentMap","app.gridCheck","app.gridCheckMap","app.problemFeedback","app.problemFeedbackDetails","app.problemFeedbackDetailsMap","app.account","app.accountDetails","app.history","app.map","app.appReceivedMessage","app.messageContent","app.setting","app.setNet","app.commonHttpService","app.commonMap"]).run(t).config(a).constant("SYS_INFO",{SERVER_PATH:"http://172.72.100.61",SERVER_PORT:"8090",VERSION:"1.0.0",DIGITS:2}).controller("AppController",e),e.$inject.LoginService,t.$inject=["$rootScope","$location","$ionicPlatform","$ionicHistory","$ionicPopup"]}(),function(){"use strict";angular.module("app.account",[])}(),function(){"use strict";angular.module("app.assessment",[])}(),function(){"use strict";angular.module("app.gridCheck",[])}(),function(){"use strict";angular.module("app.history",[])}(),function(){"use strict";angular.module("app.home",[])}(),function(){"use strict";angular.module("app.login",[])}(),function(){"use strict";angular.module("app.map",[])}(),function(){"use strict";angular.module("app.appReceivedMessage",[])}(),function(){"use strict";angular.module("app.setNet",[])}(),function(){"use strict";angular.module("app.problemFeedback",[])}(),function(){"use strict";angular.module("app.setting",[])}(),function(){"use strict";angular.module("app.waitForWork",[])}(),function(){"use strict";angular.module("app.accountDetails",[])}(),function(){"use strict";angular.module("app.addAssessment",[])}(),function(){"use strict";angular.module("app.assessmentStatus",[])}(),function(){"use strict";angular.module("app.assessmentStatusDetails",[])}(),function(){"use strict";angular.module("app.planDetails",[])}(),function(){"use strict";angular.module("app.commonHttpService",[])}(),function(){"use strict";angular.module("app.commonMap",[])}(),function(){"use strict";angular.module("app.gridCheckMap",[])}(),function(){"use strict";angular.module("app.savedData",[])}(),function(){"use strict";angular.module("app.messageContent",[])}(),function(){"use strict";angular.module("app.problemFeedbackDetails",[])}(),function(){"use strict";angular.module("app.problemFeedbackDetailsMap",[])}(),function(){"use strict";angular.module("app.addAssessmentMap",[])}(),function(){"use strict";function e(e,t,a,o){function n(){i()}function i(){t.getQueryCriteriaList(function(e){l.queryCriteriaObj=e[0]})}function s(){l.accountType&&""!=l.accountType&&(""==l.accountType?l.queryCriteria.accountType="":l.queryCriteria.accountType=JSON.parse(l.accountType).code),""==l.queryCriteria.level&&""==l.queryCriteria.cityPlace&&""==l.queryCriteria.accountType&&""==l.queryCriteria.keyword?o.confirm({title:"提示",template:"查询全部台帐可能会导致等待时间很长，要继续么？",cancelText:"取消",cancelType:"button-royal",okText:"确认",okType:"button-positive"}).then(function(e){e&&t.getAccountListByQueryCriteria(l.queryCriteria,function(e){l.accountList=e[0]})}):t.getAccountListByQueryCriteria(l.queryCriteria,function(e){l.accountList=e[0]})}function r(e){e&&(l.levelList=JSON.parse(e).subclass)}function c(e,t){a.go("accountDetails",{accountData:e,code:t})}var l=this;l.title="环卫台帐",l.optionAll='{"code":"", "id": "", "name": "全部类型", "subclass": []}',l.queryCriteriaObj={},l.accountType,l.levelList=[],l.queryCriteria={cityPlace:"",accountType:"",level:"",keyword:""},l.accountList=[],l.fun={updateLevelArrayByType:r,getAccountListByQueryCriteria:s,toAccountDetails:c},n()}angular.module("app.account").controller("AccountController",e),e.$inject=["$scope","AccountService","$state","$ionicPopup"]}(),function(){"use strict";function e(e){e.state("account",{url:"/account",cache:!0,templateUrl:"templates/account/account.html"})}angular.module("app.account").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){function a(e){var a="";t.getCommonData(a,e)}function o(e,a){var o="/hwweb/Ledger/findFacilitiesByCondition.action?areaId="+e.cityPlace+"&code="+e.accountType+"&subclassId="+e.level+"&name="+e.keyword;t.getCommonData(o,a)}function n(e){var a="/hwweb/Ledger/findAllAreaAndItem.action";t.getCommonData(a,e)}var i={getAccountList:a,getAccountListByQueryCriteria:o,getQueryCriteriaList:n};return i}angular.module("app.account").service("AccountService",e),e.$inject=["$http","MyHttpService"]}(),function(){"use strict";function e(e,t,a,o){function n(){o.getPlanList(e.userId,function(e){r.planList=e})}function i(){o.getPlanList(e.userId,function(e){r.planList=e,t.$broadcast("scroll.refreshComplete")})}function s(e){a.go("planDetails",{planDetailsData:e,fromWhere:"assessment"})}var r=this;r.title="综合考核",r.titleController={},r.toPlanDetails=s,r.planList=[],r.fun={pullToRefreshAssessmentData:i},n()}angular.module("app.assessment").controller("AssessmentController",e),e.$inject=["$rootScope","$scope","$state","AssessmentService"]}(),function(){"use strict";function e(e){e.state("assessment",{url:"/assessment",cache:!0,templateUrl:"templates/assessment/assessment.html"})}angular.module("app.assessment").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a){function o(e,t){var o="/hwweb/Comprehensive/findDataByUserId.action?userId="+e;a.getCommonData(o,t)}var n={getPlanList:o};return n}angular.module("app.assessment").service("AssessmentService",e),e.$inject=["$http","SYS_INFO","MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c){function l(){f.db||(f.db=c.openSqlDB()),a.$on("$ionicView.beforeEnter",function(e){n.getGridCheckQuestionCodeArray(function(e){f.questionCode=e,f.questionCodeObj=f.questionCode[0]})})}function u(){o.go("gridCheckMap")}function p(){var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,popoverOptions:Camera.PopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};r.getPicture(e).then(function(e){var t=document.getElementById("gridCheckImg");t.src="data:image/jpeg;base64,"+e,f.imgName=moment().format("YYYY-MM-DD HH:mm:ss")+".jpeg",f.uploadData.img=e},function(e){s.alert({title:"照片获取失败，请重新拍照!"})})}function d(){i.getLocationInfoByGPS(function(e){f.uploadData.areaName=e.district,f.uploadData.streetName=e.township,a.$apply()})}function m(){if(f.uploadData.examiner=e.userName,t.get("cacheGridCheckMapData")&&(f.uploadData.point=t.get("cacheGridCheckMapData").get("position"),console.log(f.uploadData.point),f.uploadData.address=t.get("cacheGridCheckMapData").get("address")),f.uploadData.problemCode=f.questionCodeObj.id,f.uploadData.problemName=f.questionCodeObj.name,console.log("网格化巡检需要上传的数据："),console.log(f.uploadData),""==f.uploadData.areaName)s.alert({title:"市区不能为空！"}).then();else if(""==f.uploadData.streetName)s.alert({title:"街道不能为空！"}).then();else if(""==f.uploadData.problemCode||null==f.uploadData.problemCode)s.alert({title:"问题代码不能为空！"});else if(""==f.uploadData.problemName||null==f.uploadData.problemName)s.alert({title:"问题代码不能为空！"});else if(""==f.uploadData.point||""==f.uploadData.address)s.alert({title:"请从地图选择详细的检查地点"}).then();else{var a=JSON.stringify(f.uploadData);n.uploadGridCheckData(a,function(e){if("failed"==e)try{var t={};t.date=moment().format("YYYY/MM/DD/HH:mm:ss"),t.address=f.uploadData.address,t.type="gridCheck",t.data=a,c.insertDataToSqlDB(f.db,t)}catch(e){}})}}function g(){""!=f.uploadData.img&&s.confirm({title:"提示",template:"确认删除此照片么？",cancelText:"取消",cancelType:"button-royal",okText:"确认",okType:"button-positive"}).then(function(e){if(e){f.uploadData.img="";var t=document.getElementById("gridCheckImg");t.src="assets/global/img/gridCheck/icon_streetscape.jpg"}})}var f=this;f.db,f.title="网格化巡检",f.questionCode=[],f.questionCodeObj={},f.imgName="",f.uploadData={examiner:"",areaName:"",streetName:"",problemCode:"",problemName:"",description:"",location:"",point:"",img:""},f.fun={toGridCheckMap:u,takeGridCheckPicture:p,getGridCheckLocation:d,uploadGridCheckData:m,deletePic:g},l()}angular.module("app.gridCheck").controller("GridCheckController",e),e.$inject=["$rootScope","$cacheFactory","$scope","$state","GridCheckService","CommonMapService","$ionicPopup","$cordovaCamera","HomeService"]}(),function(){"use strict";function e(e){e.state("gridCheck",{url:"/gridCheck",cache:!0,templateUrl:"templates/gridCheck/gridCheck.html"})}angular.module("app.gridCheck").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t){var a='/hwweb/AssignmentAssessment/findDItem.action?typeId=""';e.getCommonData(a,t)}function a(t,a){var o="/hwweb/GridInspection/saveRegionPro.action";e.uploadCommonData(o,t,a)}var o={getGridCheckQuestionCodeArray:t,uploadGridCheckData:a};return o}angular.module("app.gridCheck").service("GridCheckService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o){function n(){for(var e=0;e<12;e++)r.monthArray[e]=e+1;console.log(r.monthArray);for(var e=0;e<5;e++)r.yeahArray[e]=r.thisYeah-e;var t={keyword:"",selectedYeah:r.thisYeah,selectedMonth:r.thisMonth};o.getHistoryDataByCondition(t,function(e){r.historyList=e})}function i(e){a.go("planDetails",{assessmentData:e,fromWhere:"history"})}function s(){o.getHistoryDataByCondition(r.queryCriteria,function(e){r.historyList=e})}var r=this;r.title="历史考核记录",r.fun={toPlanDetails:i,getHistoryDataByCondition:s},r.toPlanDetails=i,r.historyList=[],r.yeahArray=[],r.monthArray=[],r.thisYeah=moment().format("YYYY"),r.thisMonth=moment().format("M"),r.queryCriteria={keyword:"",selectedYeah:"",selectedMonth:""},n()}angular.module("app.history").controller("HistoryController",e),e.$inject=["$rootScope","$scope","$state","HistoryService"]}(),function(){"use strict";function e(e){e.state("history",{url:"/history",templateUrl:"templates/history/history.html"})}angular.module("app.history").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/Comprehensive/viewHistory.action?name="+t.keyword+"&year="+t.selectedYeah+"&month="+t.selectedMonth;e.getCommonData(o,a)}var a={getHistoryDataByCondition:t};return a}angular.module("app.history").service("HistoryService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c,l,u,p){function d(){function t(){console.log("轮询获取消息success")}function o(){console.log("循环获取获取消息error")}function n(){}i.createSqlDB(function(){a.$on("$ionicView.enter",function(e){i.getContentDataNum(function(e){A.saveDataNum=e})})}),r.getWeather(function(e){A.weather=e}),A.savedData=i.getSavedUploadedData(),A.savedData&&(A.hasSavedData=!0,A.saveDataNum=A.savedData.length);var s=l(function(){i.getUnReadMsgCount(e.userId)},3e5);s.then(t,o,n)}function m(){o.go("waitForWork")}function g(){A.isCommonAccount?p.alert({title:"提示",template:"公共账户无法查看综合考核"}):o.go("assessment")}function f(){o.go("gridCheck")}function h(){o.go("problemFeedback")}function v(){o.go("account")}function b(){o.go("history")}function D(){o.go("map")}function y(){o.go("recMessage")}function P(){o.go("setting")}function S(){o.go("savedData")}var A=this;A.title="请选择工作",A.hasSavedData=!0,A.saveDataNum="20",A.savedData={},A.isCommonAccount=e.isCommonAccount,A.weather={},A.msgCount=e.unReadMsgCount,A.homeWorkController={toWaitForWork:m,toComprehensiveAssessment:g,toGridCheck:f,toProblemFeedback:h,toAccount:v,toHistory:b,toMap:D,toMessage:y,toSettings:P,toSavedData:S},d()}angular.module("app.home").controller("HomeController",e),e.$inject=["$rootScope","$localStorage","$scope","$state","$filter","HomeService","SYS_INFO","GetWeatherService","$stateParams","$interval","$cordovaCamera","$ionicPopup"]}(),function(){"use strict";function e(e){e.state("home",{url:"/home",cache:!0,templateUrl:"templates/home/home.html"})}angular.module("app.home").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r){function c(){return e.savedData?e.savedData:null}function l(e){var o=a.SERVER_PATH+":"+a.SERVER_PORT+"/hwweb/AppMessage/unreadMsg.action?userId="+e;t.get(o).then(function(e){1==e.data.success&&(n.unReadMsgCount=e.data.data[0],console.log("+++++++++++++++++++++++++"),console.log(e.data.data[0]),console.log(n.unReadMsgCount),console.log("+++++++++++++++++++++++++"))},function(e){})}function u(e){try{var t=window.sqlitePlugin.openDatabase({name:"HuanWei2.db",location:"default"},function(a){t.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS ContentSave (id INTEGER PRIMARY KEY AUTOINCREMENT,date TEXT NOT NULL,address TEXT NOT NULL, type TEXT NOT NULL,data TEXT NOT NULL)",[],function(t,a){e()},function(e){s.alert({title:"提示",template:"表创建失败"})})},function(e){s.alert({title:"提示",template:"事务error: "+e.message})},function(){console.log("transaction ok")})},function(e){s.alert({title:"提示",template:"创建数据库失败："+JSON.stringify(e)}).then(function(e){return null})})}catch(e){s.alert({title:"错误提示",template:"本地数据库相关操作出现错误"}).then(function(e){return null})}}function p(){try{var e=window.sqlitePlugin.openDatabase({name:"HuanWei2.db",location:"default"});return e}catch(e){s.alert({title:"错误提示",template:"本地数据库相关操作出现错误"}).then(function(e){return null})}}function d(e,t){if(t&&e)try{e.transaction(function(e){var a="INSERT INTO ContentSave(date,address,type,data) VALUES (?,?,?,?)";e.executeSql(a,[t.date,t.address,t.type,t.data],function(e,t){console.log("插入数据成功："+JSON.stringify(t))},function(e){s.alert({title:"错误提示",template:"插入数据错错误: "+e.message})})},function(e){console.log("插入数据事务执行Failed!"+JSON.stringify(e))},function(){console.log("插入数据事务执行OK")})}catch(e){console.log("JavaScript错误捕获，插入数据事务出现问题")}}function m(e,t){var a="SELECT * FROM ContentSave";try{e.transaction(function(e){e.executeSql(a,[],function(e,a){t(a)},function(e){s.alert({title:"错误提示",template:"从数据库查询数据出现错误"+e})})},function(e){alert("查询事务Failed"+e.message)},function(){console.log("查询事务Success")})}catch(e){s.alert({title:"提示",template:"JavaScript错误捕获，查询数据事务出现问题"})}}function g(e,t,a){a&&r.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>删除数据中...</span></div>'});var o="DELETE FROM ContentSave WHERE date = ?";try{e.transaction(function(e){e.executeSql(o,[t],function(e,t){a&&(r.hide(),s.alert({title:"提示",template:"删除成功"}))},function(e,t){a&&(r.hide(),s.alert({title:"提示",template:"从数据库删除数据出现错误"+JSON.stringify(t)}))})},function(e){a&&(r.hide(),alert("删除数据事务Failed"+e.message))},function(){console.log("删除事务Success")})}catch(e){r.hide(),s.alert({title:"提示",template:"JavaScript错误捕获，删除数据事务出现问题"})}}function f(e){var t=p();m(t,function(t){var a=t.rows.length;e(a)})}var h={getSavedUploadedData:c,getUnReadMsgCount:l,createSqlDB:u,insertDataToSqlDB:d,selectDataFromSqlDB:m,openSqlDB:p,deleteDataFromSqlDB:g,getContentDataNum:f};return h}function t(e,t){function a(t){e.get(n).then(function(e){e.data?(i.weatherDate=moment().format("MM月DD日"),i.address="青岛",i.temperature=o(e.data),i.weather=e.data.data.forecast[0].type,t(i)):(i.weatherDate=moment().format("MM月DD日"),i.address="青岛",i.temperature="20度",i.weather="晴",t(i))},function(e){i.weatherDate=moment().format("MM月DD日"),i.address="青岛",i.temperature="20度",i.weather="晴",t(i)}),console.log(i)}function o(e){if(e.data){var t=e.data.forecast[0].low.substring(3,5),a=e.data.forecast[0].high.substring(3,5),o=t+"~"+a+"℃";return o}return""}var n=t.SERVER_PATH+":"+t.SERVER_PORT+"/hwweb/Weather/WeatherJson.action",i={},s={getWeather:a};return s}angular.module("app.home").service("GetWeatherService",t).factory("HomeService",e),e.$inject=["$localStorage","$http","SYS_INFO","$interval","$rootScope","$cordovaSQLite","$ionicPopup","$ionicLoading"],t.$inject=["$http","SYS_INFO","$interval"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){}function s(){device?e.imei=device.imei:e.imei="123456",t.go("setNet",{imei:e.imei})}function r(){a.login(e.info.userName,e.info.password,e.imei,e.isCommonAccount,e.info.isRemAccountAndPwd,e.info)}e.doLogin=r,e.setNetAddress=s,e.isCommonAccount=!1,e.userInfo=a.getUserInfo(),e.imei="",e.info={userName:e.userInfo.userName,password:e.userInfo.password,isRemAccountAndPwd:e.userInfo.isRemAccountAndPwd},i(),a.setServerInfo()}var t=angular.module("app.login");t.controller("LoginController",e),e.$inject=["$scope","$state","LoginService","$cordovaDevice","$ionicPopup"]}(),function(){function e(e){e.state("login",{url:"/login",cache:!1,templateUrl:"templates/login/login.html"})}angular.module("app.login").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c){function l(e,i,r,c,l,d){n.show({template:"正在登录..."}),o(function(){n.hide()},3e4),i=hex_md5(i);var m="/hwweb/AppUser/userLogin.action?";switch(c){case!1:t.get(a.SERVER_PATH+":"+a.SERVER_PORT+m+"account="+e+"&password="+i+"&imei="+r).then(function(e){s.isCommonAccount=!1,u(e,l,d)},function(e){p(e)});break;case!0:t.get(a.SERVER_PATH+":"+a.SERVER_PORT+m+"account="+e+"&password="+i).then(function(e){s.isCommonAccount=!0,u(e,l,d)},function(e){p(e)})}}function u(e,t,a){console.log(e),"1"==e.data.success?o(function(){t?m(a):h(),d(e.data.data[0])},100).then(function(){n.hide(),c.go("home")}):(n.hide(),i.alert({title:e.data.msg}).then(function(e){}))}function p(e){n.hide(),i.alert({title:"登陆失败",template:e.data}).then(function(e){})}function d(e){e?(s.userId=e.id,s.userName=e.name,s.userOrg=e.org):(s.userId="",s.userName="",s.userOrg="")}function m(t){var a={userName:"",password:"",isRemAccountAndPwd:!1};t&&(a.userName=t.userName,a.password=t.password,a.isRemAccountAndPwd=t.isRemAccountAndPwd),e.userInfo=a}function g(){function e(){return r.getUUID()}document.addEventListener("deviceready",e,!1)}function f(){var t={userName:"",password:"",isRemAccountAndPwd:!1};return e.userInfo&&(t.userName=e.userInfo.userName,t.password=e.userInfo.password,t.isRemAccountAndPwd=e.userInfo.isRemAccountAndPwd),t}function h(){delete e.userInfo}function v(){var t={SERVER_PATH:"",SERVER_PORT:""};e.serverInfo?(a.SERVER_PATH=e.serverInfo.SERVER_PATH,a.SERVER_PORT=e.serverInfo.SERVER_PORT):(t.SERVER_PATH=a.SERVER_PATH,t.SERVER_PORT=a.SERVER_PORT,e.serverInfo=t)}var b={login:l,getUserInfo:f,setServerInfo:v,getImei:g};return b}angular.module("app.login").service("LoginService",e),e.$inject=["$localStorage","$http","SYS_INFO","$timeout","$ionicLoading","$ionicPopup","$rootScope","$cordovaDevice","$state"]}(),function(){"use strict";function e(e,t,a,o,n,i,s){function r(){d(),i.$on("$ionicView.leave",function(e){D.timer&&s.cancel(D.timer)})}function c(){var e={type:"cheliang",keyword:""};t.getMapInfoList(e,function(e){if(D.mapPositionObj=e[0],D.map.remove(D.carMarkers),D.carMarkers.length>0&&(D.carMarkers=[]),D.mapPositionObj.cheliang)for(var t in D.mapPositionObj.cheliang){var a=o.getPositionArray(D.mapPositionObj.cheliang[t].point),n={type:"cheliang",name:D.mapPositionObj.cheliang[t].plateNo,vehicleType:D.mapPositionObj.cheliang[t].vehicleType,VehicleModelType:D.mapPositionObj.cheliang[t].VehicleModelType,vehicleFirstType:D.mapPositionObj.cheliang[t].vehicleFirstType,obj:D.mapPositionObj.cheliang[t]};a.length>0&&(a=a[0]);var i=new AMap.Marker({position:a,extData:n,content:'<div style="background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;"></div>',offset:new AMap.Pixel((-15),(-15)),map:D.map}).on("touchend",g);D.carMarkers.push(i)}})}function l(){console.log("轮询获取车辆的信息")}function u(){console.log("循环获取车辆的信息失败")}function p(){}function d(){D.map||(D.map=e.initMap()),D.map.setZoom(17),D.markerPerson=new AMap.Marker,e.getCoordinateInfo(function(t){D.map.setCenter(t),D.markerPerson.setPosition(t),D.map.setZoom(17),D.markerPerson.setMap(D.map),e.getLocationByLatitudeAndLongitude(t,function(e){D.district=e.district,i.$apply()}),console.log(D.district)})}function m(e){D.map.clearMap(),D.markers=[],D.carMarkers=[],t.getMapInfoList(e,function(e){if(D.mapPositionObj=e[0],D.mapPositionObj){if(D.mapPositionObj.guojietianqiao)for(var t in D.mapPositionObj.guojietianqiao){var a={type:"guojietianqiao",bridgeName:D.mapPositionObj.guojietianqiao[t].bridgeName,areaId:D.mapPositionObj.guojietianqiao[t].areaId,cleanLevel:D.mapPositionObj.guojietianqiao[t].cleanLevel,startEnd:D.mapPositionObj.guojietianqiao[t].startEnd,obj:D.mapPositionObj.guojietianqiao[t]},n=o.getPositionArray(D.mapPositionObj.guojietianqiao[t].point);n.length>0&&(n=n[0],console.log("过街天桥"),console.log(n));var i=new AMap.Marker({position:n,extData:a,clickable:!0,content:'<div style="background-color: rgba(0,0,0,0.5); height: 24px; width: 24px; border: 1px solid rgba(152,152,152, 0.4); border-radius: 12px; box-shadow: rgb(152,152,152) 0px 0px 1px;"></div>',offset:new AMap.Pixel((-15),(-15)),map:D.map});AMap.event.addListener(i,"touchend",function(e){g(e)}),D.markers.push(i)}if(D.mapPositionObj.shoujizhan)for(var t in D.mapPositionObj.shoujizhan){var n=o.getPositionArray(D.mapPositionObj.shoujizhan[t].point),a={type:"shoujizhan",RCPsname:D.mapPositionObj.shoujizhan[t].RCPsname,areaid:D.mapPositionObj.shoujizhan[t].areaid,belongsStreet:D.mapPositionObj.shoujizhan[t].belongsStreet,site:D.mapPositionObj.shoujizhan[t].site,obj:D.mapPositionObj.shoujizhan[t]};n.length>0&&(n=n[0],console.log("收集站"),console.log(n)),D.markers.push(new AMap.Marker({position:n,extData:a,content:'<div style="background-color: rgba(22,141,202,0.5); height: 24px; width: 24px; border: 1px solid rgba(22,141,202,0.4); border-radius: 12px; box-shadow: rgb(22,141,202) 0px 0px 1px;"></div>',offset:new AMap.Pixel((-15),(-15)),map:D.map}).on("touchend",g))}if(D.mapPositionObj.gongche)for(var t in D.mapPositionObj.gongche){var n=o.getPositionArray(D.mapPositionObj.gongche[t].point),a={type:"gongche",toiletName:D.mapPositionObj.gongche[t].toiletName,areaId:D.mapPositionObj.gongche[t].areaId,toiletLocation:D.mapPositionObj.gongche[t].toiletLocation,belongsStreet:D.mapPositionObj.gongche[t].belongsStreet,obj:D.mapPositionObj.gongche[t]};n.length>0&&(n=n[0],console.log("公厕"),console.log(n)),D.markers.push(new AMap.Marker({position:n,extData:a,content:'<div style="background-color: rgba(154,91,179,0.5); height: 24px; width: 24px; border: 1px solid rgba(154,91,179, 0.4); border-radius: 12px; box-shadow: rgb(154,91,179) 0px 0px 1px;"></div>',offset:new AMap.Pixel((-15),(-15)),map:D.map}).on("touchstart",g))}if(D.mapPositionObj.daolu)for(var t in D.mapPositionObj.daolu)var a={type:"daolu",roadName:D.mapPositionObj.daolu[t].roadName,areaId:D.mapPositionObj.daolu[t].areaId,cleanLevel:D.mapPositionObj.daolu[t].cleanLevel,primaryOrSecondary:D.mapPositionObj.daolu[t].primaryOrSecondary,obj:D.mapPositionObj.daolu[t]},n=o.getPositionArray(D.mapPositionObj.daolu[t].point),r=new AMap.Polyline({path:n,extData:a,strokeColor:"#1C8B08",strokeWeight:5,map:D.map}).on("click",g);if(D.mapPositionObj.cheliang){for(var t in D.mapPositionObj.cheliang){var n=o.getPositionArray(D.mapPositionObj.cheliang[t].point),a={type:"cheliang",name:D.mapPositionObj.cheliang[t].plateNo,vehicleType:D.mapPositionObj.cheliang[t].vehicleType,VehicleModelType:D.mapPositionObj.cheliang[t].VehicleModelType,vehicleFirstType:D.mapPositionObj.cheliang[t].vehicleFirstType,obj:D.mapPositionObj.cheliang[t]};n.length>0&&(n=n[0]);var d=new AMap.Marker({position:n,extData:a,content:'<div style="background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;"></div>',offset:new AMap.Pixel((-15),(-15)),map:D.map}).on("touchend",g);D.carMarkers.push(d)}D.timer&&s.cancel(D.timer),D.timer=s(function(){c()},3e4),D.timer.then(l,u,p)}else D.timer&&s.cancel(D.timer);f(0)}})}function g(e){var t=[],a="",o=e.target.getExtData().type;switch(console.log(e),e.target.getExtData().type){case"guojietianqiao":t.push("<div><div>所属市区："+e.target.getExtData().areaId+"</div>"),t.push("<div>起始位置："+e.target.getExtData().startEnd+"</div>"),t.push("<div>保洁等级："+e.target.getExtData().cleanLevel+"</div></div>"),t.push("<div><a class='checkMapDetails'>点击此处查看详情</a></div></div>"),a=e.target.getExtData().bridgeName;break;case"shoujizhan":t.push("<div><div>所属区域："+e.target.getExtData().areaid+"</div>"),t.push("<div>所属街道："+e.target.getExtData().belongsStreet+"</div>"),t.push("<div>地点："+e.target.getExtData().site+"</div></div>"),t.push("<div><a class='checkMapDetails'>点击此处查看详情</a></div></div>"),a=e.target.getExtData().RCPsname;break;case"gongche":t.push("<div><div>所属区域："+e.target.getExtData().areaId+"</div>"),t.push("<div>公厕位置："+e.target.getExtData().toiletLocation+"</div>"),t.push("<div>所属街道："+e.target.getExtData().belongsStreet+"</div></div>"),t.push("<div><a class='checkMapDetails'>点击此处查看详情</a></div></div>"),a=e.target.getExtData().toiletName;break;case"cheliang":t.push("<div><div>车辆型号："+e.target.getExtData().VehicleModelType+"</div>"),t.push("<div>车辆大类："+e.target.getExtData().vehicleFirstType+"</div>"),t.push("<div>车辆类型："+e.target.getExtData().vehicleType+"</div>"),t.push("<div><a class='checkMapDetails'>点击此处查看详情</a></div></div>"),a=e.target.getExtData().name;break;case"daolu":t.push("<div><div>所属区域："+e.target.getExtData().areaId+"</div>"),t.push("<div>保洁等级："+e.target.getExtData().cleanLevel+"</div>"),t.push("<div>主次干道："+e.target.getExtData().primaryOrSecondary+"</div>"),t.push("<div><a class='checkMapDetails'>点击此处查看详情</a></div></div>"),a=e.target.getExtData().roadName}AMapUI.loadUI(["overlay/SimpleInfoWindow"],function(n){var i=new n({autoMove:!0,infoTitle:"<strong>"+a+"</strong>",infoBody:t.join("<br/>")});switch(i.get$InfoBody().on("click",".checkMapDetails",function(t){t.stopPropagation(),b(e.target.getExtData().obj,e.target.getExtData().type)}),o){case"daolu":i.open(D.map,e.lnglat);break;default:i.open(D.map,e.target.getPosition())}})}function f(e){if(D.cluster&&D.cluster.setMap(null),1==e){var t=[{url:"http://a.amap.com/jsapi_demos/static/images/blue.png",size:new AMap.Size(32,32),offset:new AMap.Pixel((-16),(-16))},{url:"http://a.amap.com/jsapi_demos/static/images/green.png",size:new AMap.Size(32,32),offset:new AMap.Pixel((-16),(-16))},{url:"http://a.amap.com/jsapi_demos/static/images/orange.png",size:new AMap.Size(36,36),offset:new AMap.Pixel((-18),(-18))},{url:"http://a.amap.com/jsapi_demos/static/images/red.png",size:new AMap.Size(48,48),offset:new AMap.Pixel((-24),(-24))},{url:"http://a.amap.com/jsapi_demos/static/images/darkRed.png",size:new AMap.Size(48,48),offset:new AMap.Pixel((-24),(-24))}];D.cluster=new AMap.MarkerClusterer(D.map,D.markers,{styles:t,gridSize:80})}else D.cluster=new AMap.MarkerClusterer(D.map,D.markers,{gridSize:80})}function h(){console.log(D.accountList),D.queryCriteria.type="";for(var e=0;e<5;e++)D.accountList[e].selected&&(D.queryCriteria.type+=D.accountList[e].code+",",console.log(D.queryCriteria));if(D.queryCriteria.type.length>0)if(6==D.queryCriteria.type.split(",").length)a.confirm({title:"提示",template:"查询全部可能会导致等待时间很长，要继续么？",buttons:[{text:"取消",type:"button-positive"},{text:"确认",type:"button-calm"}]}).then(function(e){if(e){D.queryCriteria.type="",console.log(D.queryCriteria.type);var t=D.queryCriteria;m(t)}});else{D.queryCriteria.type=D.queryCriteria.type.substring(0,D.queryCriteria.type.length-1),console.log(D.queryCriteria.type),console.log(D.queryCriteria.type);var t=D.queryCriteria;m(t)}else a.alert({title:"提示",template:"请先选择要查询的类型"})}function v(){if(D.accountList[5].selected)for(var e=0;e<5;e++)D.accountList[e].selected=!0;else for(var e=0;e<5;e++)D.accountList[e].selected=!1}function b(e,t){console.log(e),console.log(t),n.go("accountDetails",{accountData:e,code:t})}var D=this;D.title="地图查询",D.queryCriteria={type:"",keyword:""},D.district="",D.accountList=[{id:"0",account:"公厕",selected:!1,code:"gongche"},{id:"1",account:"道路",selected:!1,code:"daolu"},{id:"2",account:"车辆",selected:!1,code:"cheliang"},{id:"3",account:"收集站",selected:!1,code:"shoujizhan"},{id:"4",account:"过街天桥",selected:!1,code:"guojietianqiao"},{id:"5",account:"全部",selected:!1,code:"all"}],D.map,D.marker,D.cluster,D.markerPerson,D.circle,D.timer,D.carSelected=!1,D.markers=[],D.carMarkers=[],D.centerPositionNum=0,D.mapPositionObj={},D.fun={getAccountsPositionData:h,updateCheckBoxStatus:v},r()}angular.module("app.map").controller("MapController",e),e.$inject=["CommonMapService","MapService","$ionicPopup","AddAssessmentMapService","$state","$scope","$interval"]}(),function(){"use strict";function e(e){e.state("map",{url:"/map",templateUrl:"templates/map/map.html"})}angular.module("app.map").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/Ledger/findMap.action?code="+t.type+"&name="+t.keyword;e.getCommonData(o,a)}var a={getMapInfoList:t};return a}angular.module("app.map").service("MapService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a){function o(){t.getMessagesByUserId(a.userId,function(e){r.messages=e})}function n(e){}function i(){r.messages=[];var o="";a.userId&&(o=a.userId),t.doRefresh(o,function(e){r.messages=e,console.log(r.messages)},function(){e.$broadcast("scroll.refreshComplete")})}function s(e){}var r=this;r.title="已收到消息",r.refreshMessageList=i,r.openMsgContent=n,r.fun={refreshMessageList:i,toMessageContent:s},r.messages=[],o()}angular.module("app.appReceivedMessage").controller("MessageController",e),e.$inject=["$scope","MessageService","$rootScope"]}(),function(){"use strict";function e(e){e.state("recMessage",{url:"/recMessage",templateUrl:"templates/message/recMessage.html"})}angular.module("app.appReceivedMessage").config(e),
e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a){function o(t,a){var o="/hwweb/AppMessage/findMsgByUserId.action?userId=123";e.getCommonData(o,a)}function n(e,o,n){var i=t.SERVER_PATH+":"+t.SERVER_PORT+"/hwweb/AppMessage/findMsgByUserId.action?userId=123";a.get(i).success(function(e){o(e.data)}).finally(function(){n()})}var i={getMessagesByUserId:o,doRefresh:n};return i}angular.module("app.appReceivedMessage").service("MessageService",e),e.$inject=["MyHttpService","SYS_INFO","$http"]}(),function(){"use strict";function e(e,t,a,o,n){e.netSetList=[{placeholderValue:"服务器地址：",value:a.SERVER_PATH},{placeholderValue:"服务器端口：",value:a.SERVER_PORT}],n.imei&&(e.IMEI=n.imei),e.setNet=function(){t.saveNetSettings(e.netSetList[0].value,e.netSetList[1].value,function(){o.goBack()})},e.backToLogin=function(){o.goBack()}}angular.module("app.setNet").controller("SetNetController",e),e.$inject=["$scope","SetNetService","SYS_INFO","$ionicHistory","$stateParams"]}(),function(){function e(e){e.state("setNet",{url:"/setNet",params:{imei:""},cache:!1,controller:"SetNetController",templateUrl:"templates/setNet/net.html"})}angular.module("app.setNet").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){function a(a,o,n){var i={SERVER_PATH:a,SERVER_PORT:o};e.serverInfo=i,t.SERVER_PATH=i.SERVER_PATH,t.SERVER_PORT=i.SERVER_PORT,n()}var o={saveNetSettings:a};return o}angular.module("app.setNet").service("SetNetService",e),e.$inject=["$localStorage","SYS_INFO"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){o.$on("$ionicView.beforeEnter",function(t){n.getProblemList(e.userId,function(e){l.problemList=e})})}function s(e){c(e)}function r(e){c(e)}function c(e){t.go("problemFeedbackDetails",{problemItem:e,fromWhere:"problemFeedback"})}var l=this;l.title="问题反馈",l.fun={checkProblemDetails:s,feedbackProblem:r},l.problemList=[],i()}angular.module("app.problemFeedback").controller("ProblemFeedbackController",e),e.$inject=["$rootScope","$state","$ionicPopup","$scope","ProblemFeedbackService"]}(),function(){"use strict";function e(e){e.state("problemFeedback",{url:"/problemFeedback",cache:!0,templateUrl:"templates/problemFeedback/problemFeedback.html"})}angular.module("app.problemFeedback").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/GridInspection/CheckProblem.action?userId="+t;e.getCommonData(o,a)}var a={getProblemList:t};return a}angular.module("app.problemFeedback").service("ProblemFeedbackService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a){function o(){a.getWeather(function(e){n.weather=e})}var n=this;n.title="个人信息",n.group=e.userOrg,n.name=e.userName,n.weather={},o()}angular.module("app.setting").controller("SettingController",e),e.$inject=["$rootScope","$scope","GetWeatherService"]}(),function(){"use strict";function e(e){e.state("setting",{url:"/setting",cache:!0,templateUrl:"templates/setting/setting.html"})}angular.module("app.setting").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){var t={};return t}angular.module("app.setting").service("userInfoService",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,a,o){function n(){e.$on("$ionicView.beforeEnter",function(e){t.getWaitForWorkInfo(a.userId,function(e){if(r.isCommonAccount){r.workList=[];for(var t in e)"无"==e[t].eDate&&r.workList.push(e[t])}else r.workList=e})})}function i(){t.getWaitForWorkInfo(a.userId,function(t){if(r.isCommonAccount){r.workList=[];for(var a in t)"无"==t[a].eDate&&r.workList.push(t[a])}else r.workList=t;e.$broadcast("scroll.refreshComplete")})}function s(e){"无"==e.sDate?o.go("problemFeedbackDetails",{problemItem:e,fromWhere:"waitForWork"}):o.go("planDetails",{planDetailsData:e,fromWhere:"waitForWork"})}var r=this;r.title="待办工作",r.titleController={},r.workList=[],r.isCommonAccount=a.isCommonAccount,r.toJobDetails=s,r.fun={pullToRefreshWaitForWorkDetails:i},n()}angular.module("app.waitForWork").controller("WaitForWorkController",e),e.$inject=["$scope","WaitForWorkService","$rootScope","$state"]}(),function(){"use strict";function e(e){e.state("waitForWork",{url:"/waitForWork",cache:!0,templateUrl:"templates/waitForWork/waitForWork.html"})}angular.module("app.waitForWork").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c,l){function u(t,a){var o="/hwweb/AssignmentAssessment/findDataByUserId?userId="+t;e.getCommonData(o,a)}var p={getWaitForWorkInfo:u};return p}angular.module("app.waitForWork").service("WaitForWorkService",e),e.$inject=["MyHttpService","$localStorage","$http","SYS_INFO","$timeout","$ionicLoading","$ionicPopup","$rootScope","$cordovaDevice","$state"]}(),function(){"use strict";function e(e,t,a){function o(){if(null!=a.accountData&&(n.accountDetailsData=a.accountData),null!=a.code)switch(n.code=a.code,n.code){case"cheliang":n.title=n.accountDetailsData.plateNo;break;case"congxizuoye":n.title=n.accountDetailsData.plateId;break;case"daolu":n.title=n.accountDetailsData.roadName;break;case"gongche":n.title=n.accountDetailsData.toiletName;break;case"guojietianqiao":n.title=n.accountDetailsData.bridgeName;break;case"jishaozuoye":n.title=n.accountDetailsData.plateId;break;case"jixiezuoye":n.title=n.accountDetailsData.operateVehicle;break;case"lajitong":n.title=n.accountDetailsData.trashArea;break;case"shashuizuoye":n.title=n.accountDetailsData.plateId;break;case"shoujizhan":n.title=n.accountDetailsData.RCPsname;break;case"shouyunzuoye":n.title=n.accountDetailsData.operatePlate;break;default:n.title="台账详情"}}var n=this;n.title="",n.data={},n.installationName="",n.code="",n.accountDetailsData={},o()}angular.module("app.accountDetails").controller("AccountDetailsController",e),e.$inject=["$scope","AccountDetailsService","$stateParams"]}(),function(){"use strict";function e(e){e.state("accountDetails",{url:"/accountDetails",params:{accountData:null,code:null},cache:!0,templateUrl:"templates/account/accountDetails/accountDetails.html"})}angular.module("app.accountDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){var a={};return a}angular.module("app.accountDetails").service("AccountDetailsService",e),e.$inject=["$http","MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r){function c(){a.addAssessmentData&&(h.addAssessmentData=a.addAssessmentData),m()}function l(){t.go("addAssessmentMap",{mapPositionObj:h.mapPositionObj,from:"addAssessment"})}function u(){if(""!=h.uploadPicDataObj.img1&&""!=h.uploadPicDataObj.img2&&""!=h.uploadPicDataObj.img3)i.alert({title:"最多支持上传三张图片"}).then(function(){});else{var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:100,targetHeight:100,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};r.getPicture(e).then(function(e){if(""==h.uploadPicDataObj.img1){var t=document.getElementById("addAssessmentImg1");t.src="data:image/jpeg;base64,"+e,h.uploadPicDataObj.img1=e}else if(""==h.uploadPicDataObj.img2){var t=document.getElementById("addAssessmentImg2");t.src="data:image/jpeg;base64,"+e,h.uploadPicDataObj.img2=e}else if(""==h.uploadPicDataObj.img3){var t=document.getElementById("addAssessmentImg3");t.src="data:image/jpeg;base64,"+e,h.uploadPicDataObj.img3=e}},function(e){i.alert({title:"拍照失败，请重试！"})})}}function p(){o.queryAccountList(h.queryCriteria,function(e){h.accountList=e,e.length>0?h.spinnerShow=!0:h.spinnerShow=!1})}function d(e){switch(e.type){case"01":h.accountObj.wcCondition=e.condition;break;case"02":break;case"05":h.accountObj.level=e.cleanLevel,h.accountObj.length=e.length,h.accountObj.road=e.primaryOrSecondary,h.accountObj.width=e.width;break;case"06":h.accountObj.carCondition=e.condition}h.spinnerShow=!1,h.queryCriteria.address=e.name,h.mapPositionObj=e,h.infraId=e.id}function m(){n.getAccounts(null,function(e){h.pointReasonArray=e,h.uploadData.reason=h.pointReasonArray[0].name})}function g(e){switch(e){case"1":if(""==h.uploadPicDataObj.img1)return;break;case"2":if(""==h.uploadPicDataObj.img2)return;break;case"3":if(""==h.uploadPicDataObj.img3)return}i.confirm({title:"提示",template:"确认删除此照片么？",cancelText:"取消",cancelType:"button-royal",okText:"确认",okType:"button-positive"}).then(function(t){if(t)switch(e){case"1":var a=document.getElementById("addAssessmentImg1");a.src="assets/global/img/gridCheck/icon_streetscape.jpg",h.uploadPicDataObj.img1="";break;case"2":var o=document.getElementById("addAssessmentImg2");o.src="assets/global/img/gridCheck/icon_streetscape.jpg",h.uploadPicDataObj.img2="";break;case"3":var n=document.getElementById("addAssessmentImg3");n.src="assets/global/img/gridCheck/icon_streetscape.jpg",h.uploadPicDataObj.img3=""}})}function f(){if(h.addAssessmentData&&h.addAssessmentData.id)if(h.infraId)if(""==h.uploadData.points)i.alert({title:"扣分情况不能为空"});else if(""==h.uploadData.reason)i.alert({title:"扣分原因不能为空"});else if(""==h.uploadData.remarks)i.alert({title:"备注不能为空"});else{var t={planId:"",infraId:""};t.planId=h.addAssessmentData.id,t.infraId=h.infraId;var a=JSON.stringify(t);o.uploadAccountData(a,function(t){if(t){var a={infoId:"",planId:"",infraId:"",dItemName:"",score:"",userName:"",remarks:"",imgJson:[]};a.infoId=t[0],a.planId=h.addAssessmentData.id,a.infraId=h.infraId,a.dItemName=h.uploadData.reason,a.score=h.uploadData.points,a.userName=e.userName,a.remarks=h.uploadData.remarks;for(var n=0;n<3;n++)switch(n){case 0:a.imgJson.push(h.uploadPicDataObj.img1);break;case 1:a.imgJson.push(h.uploadPicDataObj.img2);break;case 2:a.imgJson.push(h.uploadPicDataObj.img3)}var i=JSON.stringify(a);o.uploadPointAndPicData(i,function(e){})}})}else i.alert({title:"提示",template:"您没有选择相关的设施，请先选择！"});else i.alert({title:"提示",template:"计划id未获取到，请退出此页面重新进入！"})}var h=this;h.data={},h.title="录入计划",h.spinnerShow=!1,h.infraId="",h.uploadData={level:"",road:"",length:"",points:"",width:"",reason:"",remarks:"",img:[]},h.uploadPicDataObj={img1:"",img2:"",img3:""},h.addAssessmentData={},h.queryCriteria={type:"",address:""},h.pointReasonArray=[],h.accountList=[],h.facilityTypeList=[{name:"公厕",type:"01"},{name:"转运站",type:"02"},{name:"道路",type:"05"},{name:"车辆",type:"06"}],h.accountObj={level:"",road:"",length:"",width:"",wcCondition:"",carCondition:""},h.mapPositionObj={},h.fun={toAddAssessmentMap:l,takePicture:u,spinnerHide:d,deletePic:g,queryAccountList:p,uploadDataFun:f},c()}angular.module("app.addAssessment").controller("AddAssessmentController",e),e.$inject=["$rootScope","$state","$stateParams","AddAssessmentService","AssessmentStatusDetailsService","$ionicPopup","$ionicHistory","$cordovaCamera"]}(),function(){"use strict";function e(e){e.state("addAssessment",{url:"/addAssessment",params:{addAssessmentData:null},cache:!0,templateUrl:"templates/assessment/addAssessment/addAssessment.html"})}angular.module("app.addAssessment").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i){function s(e,t,a,o){}function r(){document.addEventListener("deviceready",function(){var t={quality:50,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:100,targetHeight:100,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1,correctOrientation:!0};e.getPicture(t).then(function(e){var t=document.getElementById("myImage");t.src="data:image/jpeg;base64,"+e},function(e){})},!1)}function c(){document.addEventListener("deviceready",function(){var t={destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA};e.getPicture(t).then(function(e){var t=document.getElementById("myImage");t.src=e},function(e){}),e.cleanup().then()},!1)}function l(e,a){var o="/hwweb/Comprehensive/searchFacilities.action?name="+e.address+"&typeId="+e.type;t.getCommonData(o,a)}function u(e,t){a.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>数据上传中...</span></div>',duration:1e4});var s=o.SERVER_PATH+":"+o.SERVER_PORT+"/hwweb/AssignmentAssessment/comprehensive.action";console.log(s),console.log(e),n({method:"post",url:s,data:{data:e},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}}).then(function(e){if(e.data.success=1){var o=e.data.data;a.hide(),t(o)}else a.hide(),i.alert({title:"数据上传失败"})},function(e){a.hide(),i.alert({title:"数据上传失败"})})}function p(e,a){var o="/hwweb/AssignmentAssessment/reportPro.action";t.uploadCommonData(o,e,a)}var d={addNewAssessment:s,getPhonePictureData:r,getPhonePicturePath:c,queryAccountList:l,uploadAccountData:u,uploadPointAndPicData:p};return d}angular.module("app.addAssessment").service("AddAssessmentService",e),e.$inject=["$cordovaCamera","MyHttpService","$ionicLoading","SYS_INFO","$http","$ionicPopup"]}(),function(){"use strict";function e(e,t,a,o,n,i,s){function r(){o.planDetailsData&&(p.data=o.planDetailsData,console.log(p.data)),t.$on("$ionicView.beforeEnter",function(e){n.getAssessmentStatusList(p.data,function(e){p.assessmentStatusList=e})})}function c(){null!=p.data&&(null==p.data.status||0==p.data.status?n.checkOverAndUpload(p.data):s.alert({title:"该考核任务已经完成！"}).then(function(e){}))}function l(){null!=p.data&&(null==p.data.status||0==p.data.status?a.go("assessmentStatusDetails",{assessmentStatusData:p.data,isEdit:!0}):s.alert({title:"该考核任务已经完成！"}).then(function(e){}))}function u(e){e.typeId=p.data.typeId,e.infraId=p.data.infraId,a.go("assessmentStatusDetails",{assessmentStatusData:e,isEdit:!1})}var p=this;p.title="考核情况",p.data={},p.fun={toAssessmentStatusDetails:l,upload:c,checkStatusDetails:u},p.assessmentStatusList=[],r()}angular.module("app.assessmentStatus").controller("AssessmentStatusController",e),e.$inject=["$rootScope","$scope","$state","$stateParams","AssessmentStatusService","$ionicLoading","$ionicPopup"]}(),function(){"use strict";function e(e){e.state("assessmentStatus",{url:"/assessmentStatus",params:{planDetailsData:null},cache:!0,templateUrl:"templates/assessment/assessmentStatus/assessmentStatus.html"})}angular.module("app.assessmentStatus").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i){function s(e,t){var o="/hwweb/AssignmentAssessment/findProView.action?planId="+e.planId+"&infrastructureId="+e.infraId+"&infoId="+e.id;a.getCommonData(o,t)}function r(a){o.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>数据上传中...</span></div>',duration:1e4});var s="/hwweb/AssignmentAssessment/complete.action?planId="+a.planId+"&infraId="+a.infraId;e({method:"GET",url:t.SERVER_PATH+":"+t.SERVER_PORT+s}).then(function(e){1==e.data.success&&(o.hide(),n.alert({title:"提示",template:"考核完成..."}).then(function(e){i.goBack()}))},function(e){o.hide(),n.alert({title:"失败提示",template:"上传失败，请重试！"}).then(function(e){})})}var c={getAssessmentStatusList:s,checkOverAndUpload:r};return c}angular.module("app.assessmentStatus").service("AssessmentStatusService",e),e.$inject=["$http","SYS_INFO","MyHttpService","$ionicLoading","$ionicPopup","$ionicHistory"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c,l,u){function p(){v.db||(v.db=u.openSqlDB()),v.isEdit=n.isEdit,v.serverUrl=t.SERVER_PATH+":"+t.SERVER_PORT+"/hwweb",n.assessmentStatusData&&(v.data=n.assessmentStatusData,v.title=n.assessmentStatusData.name,console.log(v.data),v.isEdit?(f(),i.getAssessmentStatusDetailsListIsEdit(v.data,function(e){v.assessmentStatusDetails=e[0],v.assessmentStatusDetails&&(v.type=v.assessmentStatusDetails.type)})):i.getAssessmentStatusDetailsListNotEdit(v.data,function(e){if(v.assessmentStatusDetails=e[0],v.assessmentStatusDetails)if(v.type=v.assessmentStatusDetails.type,v.uploadData.points=v.assessmentStatusDetails.deducted,v.uploadData.reason=v.assessmentStatusDetails.dItem,v.uploadData.remarks=v.assessmentStatusDetails.remarks,v.picBase64DataArray=v.assessmentStatusDetails.imgs,0==v.picBase64DataArray.length);else for(var t in v.picBase64DataArray){var a="img"+t,o=document.getElementById(a);o.src=v.serverUrl+v.picBase64DataArray[t]}}))}function d(){if(""==v.uploadData.points)r.alert({title:"扣分情况不能为空"});else if(""==v.uploadData.reason)r.alert({title:"扣分原因不能为空"});else if(""==v.uploadData.remarks)r.alert({title:"备注不能为空"});else{var t={infoId:"",planId:"",infraId:"",dItemName:"",score:"",userName:"",remarks:"",imgJson:[]};t.infoId=v.data.id,t.planId=v.data.planId,t.infraId=v.data.infraId,t.dItemName=v.uploadData.reason,t.score=v.uploadData.points,t.userName=e.userName,t.remarks=v.uploadData.remarks;for(var a=0;a<3;a++)switch(a){case 0:t.imgJson.push(v.uploadPicDataObj.img1);break;case 1:t.imgJson.push(v.uploadPicDataObj.img2);break;case 2:t.imgJson.push(v.uploadPicDataObj.img3)}console.log(t),i.uploadAssessmentStatusDetailsData(t,function(e){if("success"==e)l.goBack();else if("failed"==e)try{var a={};a.date=moment().format("YYYY/MM/DD/HH:mm:ss"),a.address=v.title,a.type="assessmentStatusDetails",a.data=JSON.stringify(t),u.insertDataToSqlDB(v.db,a)}catch(e){}})}}function m(){if(""!=v.uploadPicDataObj.img1&&""!=v.uploadPicDataObj.img2&&""!=v.uploadPicDataObj.img3)r.alert({title:"最多支持上传三张图片"}).then(function(){});else{var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};c.getPicture(e).then(function(e){if(""==v.uploadPicDataObj.img1){var t=document.getElementById("assessmentImg1");t.src="data:image/jpeg;base64,"+e,v.uploadPicDataObj.img1=e}else if(""==v.uploadPicDataObj.img2){var t=document.getElementById("assessmentImg2");t.src="data:image/jpeg;base64,"+e,v.uploadPicDataObj.img2=e}else if(""==v.uploadPicDataObj.img3){var t=document.getElementById("assessmentImg3");t.src="data:image/jpeg;base64,"+e,v.uploadPicDataObj.img3=e}var a=moment().format("YYYY-MM-DD HH:mm:ss")+".jpg";v.picNameArray.push(a),v.picBase64DataArray.push("data:image/jpeg;base64,"+e),v.uploadPicBase64DataArray.push(e)},function(e){})}}function g(){o.go("addAssessmentMap",{mapPositionObj:v.assessmentStatusDetails,from:"assessmentStatusDetails"})}function f(){i.getAccounts(v.data,function(e){v.reasonAccount=e,v.uploadData.reason=v.reasonAccount[0].name,console.log("扣分原因数据："),console.log(v.reasonAccount)})}function h(e){switch(e){case"1":if(""==v.uploadPicDataObj.img1)return;break;case"2":if(""==v.uploadPicDataObj.img2)return;break;case"3":if(""==v.uploadPicDataObj.img3)return}r.confirm({title:"提示",template:"确认删除此照片么？",cancelText:"取消",cancelType:"button-royal",okText:"确认",okType:"button-positive"}).then(function(t){if(console.log(t),t)switch(e){case"1":console.log(e);var a=document.getElementById("assessmentImg1");a.src="assets/global/img/gridCheck/icon_streetscape.jpg",v.uploadPicDataObj.img1="";break;case"2":console.log(e);var o=document.getElementById("assessmentImg2");o.src="assets/global/img/gridCheck/icon_streetscape.jpg",v.uploadPicDataObj.img2="";break;case"3":console.log(e);var n=document.getElementById("assessmentImg3");n.src="assets/global/img/gridCheck/icon_streetscape.jpg",v.uploadPicDataObj.img3="";break;default:console.log(e)}})}var v=this;v.data={},v.title="",v.type="05",v.isEdit=!1,v.assessmentStatusDetails={},v.reasonAccount=[],v.picNameArray=[],v.picBase64DataArray=[],v.serverUrl="",v.uploadPicBase64DataArray=[],v.uploadData={points:"",reason:"",remarks:""},v.uploadPicDataObj={img1:"",img2:"",img3:""},v.fun={uploadAssessmentStatusDetailsData:d,toCommonMap:g,takePicture:m,deletePic:h},p()}angular.module("app.assessmentStatusDetails").controller("AssessmentStatusDetailsController",e),e.$inject=["$rootScope","SYS_INFO","$scope","$state","$stateParams","AssessmentStatusDetailsService","$ionicLoading","$ionicPopup","$cordovaCamera","$ionicHistory","HomeService"]}(),function(){"use strict";function e(e){e.state("assessmentStatusDetails",{url:"/assessmentStatusDetails",params:{assessmentStatusData:null,isEdit:!1},cache:!0,templateUrl:"templates/assessment/assessmentStatusDetails/assessmentStatusDetails.html"})}angular.module("app.assessmentStatusDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/AssignmentAssessment/findFacilities.action?typeId="+t.typeId+"&infraId="+t.infraId;e.getCommonData(o,a)}function a(t,a){var o="/hwweb/AssignmentAssessment/findFacilitiesViews.action?typeId="+t.typeId+"&infraId="+t.infraId+"&resultsId="+t.id;e.getCommonData(o,a)}function o(t,a){if(t)var o="/hwweb/AssignmentAssessment/findDItem.action?typeId="+t.typeId;else var o="/hwweb/AssignmentAssessment/findDItem.action";e.getCommonData(o,a)}function n(t,a){var o="/hwweb/AssignmentAssessment/reportPro.action",n=JSON.stringify(t);e.uploadCommonData(o,n,a)}var i={getAssessmentStatusDetailsListIsEdit:t,getAssessmentStatusDetailsListNotEdit:a,getAccounts:o,uploadAssessmentStatusDetailsData:n};return i}angular.module("app.assessmentStatusDetails").service("AssessmentStatusDetailsService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){o.planDetailsData&&(c.data=o.planDetailsData,c.title=o.planDetailsData.planName),t.$on("$ionicView.beforeEnter",function(e){n.getPlanDetailsList(c.data.id,function(e){c.planDetailsList=e})})}function s(){if(c.data.id){var e={id:c.data.id};a.go("addAssessment",{addAssessmentData:e})}}function r(e){e.planId=c.data.id,a.go("assessmentStatus",{planDetailsData:e})}var c=this;c.data={},c.title="",c.fun={toAddAssessment:s},c.toAssessmentStatus=r,c.planDetailsList=[],i()}angular.module("app.planDetails").controller("PlanDetailsController",e),e.$inject=["$rootScope","$scope","$state","$stateParams","PlanDetailsService"]}(),function(){"use strict";function e(e){e.state("planDetails",{url:"/assessment/planDetails",params:{planDetailsData:null},cache:!0,templateUrl:"templates/assessment/planDetails/planDetails.html"})}angular.module("app.planDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/AssignmentAssessment/findPlanView.action?planId="+t;e.getCommonData(o,a)}var a={getPlanDetailsList:t};return a}angular.module("app.planDetails").service("PlanDetailsService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o){function n(n,i){console.log(o.SERVER_PATH+":"+o.SERVER_PORT+n);var s=[];t.show({templateUrl:"templates/common/common.loadingData.html",duration:2e4}),e({method:"GET",url:o.SERVER_PATH+":"+o.SERVER_PORT+n}).then(function(e){1==e.data.success?(t.hide(),s=e.data.data,console.log("数据获取成功"),console.log(s),i(s)):(t.hide(),a.alert({title:"提示",template:"获取数据失败"}).then(function(e){console.log("数据获取失败"),console.log(s),i(s)}))},function(e){t.hide(),a.alert({title:"提示",template:"获取数据失败"}).then(function(e){console.log("通信异常"),console.log(s),i(s)})})}function i(n,i,s){t.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>数据上传中...</span></div>',duration:1e4});var r=o.SERVER_PATH+":"+o.SERVER_PORT+n;console.log(r),console.log(i),e({method:"post",url:r,data:{data:i},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return console.log(t.join("&")),t.join("&")}}).then(function(e){(e.data.success=1)?(t.hide(),a.alert({title:"提示",template:e.data.msg}).then(function(e){s("success")})):(t.hide(),a.alert({title:"数据上传失败"}).then(function(e){s("failed")}))},function(e){t.hide(),a.alert({title:"数据上传失败"}).then(function(e){s("failed")})})}var s={getCommonData:n,uploadCommonData:i};return s}angular.module("app.commonHttpService").service("MyHttpService",e),e.$inject=["$http","$ionicLoading","$ionicPopup","SYS_INFO"]}(),function(){"use strict";function e(e,t,a,o){function n(){switch(r.fromWhere){case"gridCheck":null==r.data||void 0==r.data?o.initMap():(r.map=o.initMap(),o.getCoordinateInfo(function(e){r.marker=o.initMyPosition(r.map,e),r.map.on("click",function(e){marker.setPosition(e.lnglat),r.postion=e.lnglat,console.log(e.lnglat)})}));break;case"addAssessment":}}function i(){o.getCoordinateInfo(function(e){r.marker.setPosition(e),r.map.setZoom(12),r.map.setCenter(e)})}function s(){$state.go("gridCheck",{position:r.postion})}var r=this;r.data={},r.title="地图详情",r.fun={},r.data=a.data,r.fromWhere=a.from,r.map,r.marker,r.postion=[],r.fun={refreshMyPosition:i,sendPosition:s},n()}angular.module("app.commonMap").controller("CommonMapController",e),e.$inject=["$rootScope","$scope","$stateParams","CommonMapService"]}(),function(){"use strict";function e(e){e.state("commonMap",{url:"/commonMap",params:{data:null,from:""},templateUrl:"templates/common/map/commonMap.html"})}angular.module("app.commonMap").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a){function o(){e.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>地图数据加载中...</span></div>',duration:5e3});var t=new AMap.Map("map",{resizeEnable:!0,zoom:12,lang:"zh_cn"});return t.plugin(["AMap.ToolBar"],function(){var e=new AMap.ToolBar;t.addControl(e)}),e.hide(),t}function n(e,t){e.setCenter(t);var a=new AMap.Marker({position:t});return a.setMap(e),a.setTitle("我的位置"),a}function i(t){e.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>定位中...</span></div>',duration:1e4});var o=new Array;a.getCurrentPosition({timeout:1e4,enableHighAccuracy:!1}).then(function(a){o[0]=a.coords.longitude,o[1]=a.coords.latitude,t(o),e.hide(),console.log("Cordova使用GPS定位成功："),console.log(o)},function(a){o[0]=120.413762,o[1]=36.084807,t(o),e.hide(),console.log("Cordova使用GPS定位失败，定位地点已经设为垃管处的地理位置："),console.log("失败码："+a.code),console.log("失败信息"+a.msg)})}function s(e,t){var a={address:"",city:"",district:"",street:"",township:"",streetNumber:""};AMap.plugin("AMap.Geocoder",function(){var o=new AMap.Geocoder({city:"010"});o.getAddress(e,function(e,o){"complete"==e?(a.address=o.regeocode.formattedAddress,a.city=o.regeocode.addressComponent.city,a.district=o.regeocode.addressComponent.district,a.street=o.regeocode.addressComponent.street,a.township=o.regeocode.addressComponent.township,a.streetNumber=o.regeocode.addressComponent.streetNumber,console.log("根据经纬度来获取定位地点返回的数据："),console.log(o),console.log("根据经纬度来获取定位地点的的各种信息:"),console.log(a),t(a)):t(a)})})}function r(o){var n={address:"",city:"",district:"",street:"",township:"",streetNumber:""};e.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>定位中...</span></div>',duration:1e4});var i=[];a.getCurrentPosition({timeout:1e4,enableHighAccuracy:!1}).then(function(t){i[0]=t.coords.longitude,i[1]=t.coords.latitude,e.hide(),console.log("定位成功，坐标数组："+i),AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"010"});e.getAddress(i,function(e,t){"complete"==e?(n.address=t.regeocode.formattedAddress,n.city=t.regeocode.addressComponent.city,n.district=t.regeocode.addressComponent.district,n.street=t.regeocode.addressComponent.street,n.township=t.regeocode.addressComponent.township,n.streetNumber=t.regeocode.addressComponent.streetNumber,o(n),console.log("根据经纬度来获取定位地点返回的数据："),console.log(t),console.log("根据经纬度来获取定位地点的的各种信息:"),console.log(n)):console.log("根据经纬度来获取定位地点失败！")})})},function(a){e.hide(),o(n),t.alert({title:"定位失败，请重试！"})})}function c(e){var t;AMap.plugin("AMap.Geolocation",function(){t=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"}),t.getCurrentPosition(),AMap.event.addListener(t,"complete",function(t){var a=[];a[0]=t.position.getLng(),a[1]=t.position.getLat(),AMap.plugin("AMap.Geocoder",function(){var t=new AMap.Geocoder({city:"010"});t.getAddress(a,function(t,a){if("complete"==t){var o={};o.district=a.regeocode.addressComponent.city+a.regeocode.addressComponent.district,o.street=a.regeocode.addressComponent.street,e(o),console.log(a)}else console.log("获取地理位置信息失败！"+t+a)})}),t.accuracy&&console.log("精度："+t.accuracy+" 米"),console.log("是否经过偏移："+(t.isConverted?"是":"否"))}),AMap.event.addListener(t,"error",function(t){var a=[120.41317,36.07705];console.log("定位失败"),AMap.plugin("AMap.Geocoder",function(){var t=new AMap.Geocoder({city:"010"});t.getAddress(a,function(t,a){if("complete"==t){var o={};o.district=a.regeocode.addressComponent.city+a.regeocode.addressComponent.district,o.street=a.regeocode.addressComponent.street,e(o),console.log(a)}else console.log("获取地理位置信息失败！"+t+a)})})})})}var l={initMap:o,initMyPosition:n,getCoordinateInfo:i,getLocationInfoByGPS:r,getLocationByLatitudeAndLongitude:s,getAddressByBrowserOrIp:c};return l}angular.module("app.commonMap").service("CommonMapService",e),e.$inject=["$ionicLoading","$ionicPopup","$cordovaGeolocation"]}(),function(){"use strict";function e(e,t,a,o,n,i,s){function r(){u.map=o.initMap(),o.getCoordinateInfo(function(e){u.position=e,u.map.setZoom(15),u.marker=o.initMyPosition(u.map,e),o.getLocationByLatitudeAndLongitude(e,function(e){u.address=e.address,t.$apply()}),u.map.on("click",function(e){u.marker.setPosition(e.lnglat),u.position=e.lnglat.toString(),o.getLocationByLatitudeAndLongitude(e.lnglat,function(e){u.address=e.address,t.$apply()}),console.log("通过在地图上选点获取到的坐标："),console.log(e.lnglat),console.log("通过在地图上选点获取的详细地址："),console.log(u.address)})})}function c(){o.getCoordinateInfo(function(e){u.position=e,u.marker.setPosition(e),u.map.setZoom(15),u.map.setCenter(e),o.getLocationByLatitudeAndLongitude(e,function(e){u.address=e.address,t.$apply()})})}function l(){i.get("cacheGridCheckMapData")&&(console.log("$cacheFactory:cacheGridCheckMapData"),console.log(i.get("cacheGridCheckMapData")),i.get("cacheGridCheckMapData").destroy());var e=i("cacheGridCheckMapData");e.put("position",u.position),e.put("address",u.address),console.log("存储在本地的定位的相关数据："),console.log(e),s.goBack()}var u=this;u.title="地图详情",u.map=null,u.marker=null,u.position=[],u.address="",u.fun={refreshMyPosition:c,sendPosition:l},r()}angular.module("app.gridCheckMap").controller("GridCheckMapController",e),e.$inject=["$rootScope","$scope","$stateParams","CommonMapService","$state","$cacheFactory","$ionicHistory"]}(),function(){"use strict";function e(e){e.state("gridCheckMap",{url:"/gridCheckMap",params:{mapData:null},cache:!0,templateUrl:"templates/gridCheck/gridCheckMap/gridCheckMap.html"})}angular.module("app.gridCheckMap").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){function a(){i.db||(i.db=e.openSqlDB()),e.selectDataFromSqlDB(i.db,function(e){if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)i.savedData.push(e.rows.item(t))})}function o(a,o){t.uploadData(a,function(t){"success"==t&&(e.deleteDataFromSqlDB(i.db,a.date,!1),i.savedData.splice(o,1))})}function n(t,a){i.savedData.splice(a,1),e.deleteDataFromSqlDB(i.db,t.date,!0)}var i=this;i.db,i.title="本地内容",i.savedData=[],i.fun={uploadData:o,deleteSavedData:n},a()}angular.module("app.savedData").controller("SavedDataController",e),e.$inject=["HomeService","SavedDataService"]}(),function(){"use strict";function e(e){e.state("savedData",{url:"/savedData",cache:!0,templateUrl:"templates/home/savedData/savedData.html"})}angular.module("app.savedData").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){switch(t.type){case"gridCheck":var o="/hwweb/GridInspection/saveRegionPro.action";e.uploadCommonData(o,t.data,function(e){a(e)})}}var a={uploadData:t};return a}angular.module("app.savedData").service("SavedDataService",e),e.$inject=["MyHttpService"]}(),function(){
"use strict";function e(e,t,a,o,n,i,s,r,c){function l(){a.msgId&&(m.msgId=a.msgId),u()}function u(){t.getMessagesByMsgId(m.msgId,function(e){e[0]&&(m.msgView=e[0].msgView[0],m.msg=e[0].msg[0])})}function p(){var e=m.msg.addressee;if(e)if(d(e)){s.show({template:"正在下载附件..."});var t=moment().format("YYYY-MM-DD-HH-mm-ss"),a=e.split(".").pop(),o=encodeURI(e);window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory,function(e){e.getDirectory("appHuanWeiDownload",{create:!0,exclusive:!1},function(e){var i=new FileTransfer;i.download(o,e.toInternalURL()+t+a,function(e){s.hide(),n.confirm({title:"文件已下载",template:"文件已下载至"+e.nativeURL+"请点击确认打开文件！",cancelText:"取消",cancelType:"button-royal",okText:"确认",okType:"button-positive"}).then(function(t){t&&cordova.plugins.fileOpener2.showOpenWithDialog(e.toInternalURL(),"image/png",{error:function(e){},success:function(){}})})},function(e){s.hide(),n.alert({title:"提示",template:"文件下载失败"})},!0)})},function(){s.hide(),alert("创建文件夹失败")})}else n.alert({title:"提示",template:"附件下载地址不符合规范"});else n.alert({title:"提示",template:"附件地址为空"})}function d(e){var t=/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/,a=new RegExp(t);return 1==a.test(e)}var m=this;m.title="消息详情",m.msgView={},m.msg={},m.msgId="",m.fun={downloadFile:p},l()}angular.module("app.messageContent").controller("MessageContentController",e),e.$inject=["$scope","MessageContentService","$stateParams","$cordovaFileTransfer","$ionicPopup","$timeout","$ionicLoading","SYS_INFO","$cordovaFileOpener2"]}(),function(){"use strict";function e(e){e.state("messageContent",{url:"/messageContent",params:{msgId:""},templateUrl:"templates/message/messageContent/messageContent.html"})}angular.module("app.messageContent").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/AppMessage/msgView.action?msgId=12";e.getCommonData(o,a)}var a={getMessagesByMsgId:t};return a}angular.module("app.messageContent").service("MessageContentService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c){function l(){switch(g.db||(g.db=c.openSqlDB()),a.problemItem&&(g.data=a.problemItem),a.fromWhere&&(g.fromWhere=a.fromWhere),g.fromWhere){case"waitForWork":o.getProblemDetailsData(g.data,function(e){0==e.length||(g.problemDetails=e[0])});break;case"problemFeedback":g.problemDetails=a.problemItem}}function u(){var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};s.getPicture(e).then(function(e){var t=document.getElementById("problemFeedbackDetailsImg");t.src="data:image/jpeg;base64,"+e,g.imgPath=moment().format("YYYY-MM-DD HH:mm:ss")+".jpeg",g.uploadData.img=e},function(e){n.alert({title:"照片获取失败，请重新拍照!"})})}function p(){g.uploadData.id=g.problemDetails.id,g.uploadData.planId=g.problemDetails.planId,g.uploadData.feedbackUser=t.userName,""==g.uploadData.id||""==g.uploadData.planId||""==g.uploadData.feedbackUser?n.alert({title:"提示信息",template:"数据不全无法上传数据！"}):""==g.uploadData.feedbackDescription||""==g.uploadData.img?n.confirm({title:"提示信息",template:"整改情况未填或者没有拍照，确认要上传么？",cancelText:"取消",cancelType:"button-royal",okText:"确认",okType:"button-positive"}).then(function(e){e&&o.uploadProblemFeedbackData(g.uploadData,function(e){if("success"==e)i.goBack();else if("failed"==e)try{var t={};t.date=moment().format("YYYY/MM/DD/HH:mm:ss"),t.address=g.problemDetails.name,t.type="problemFeedbackDetails",t.data=JSON.stringify(g.uploadData),c.insertDataToSqlDB(g.db,t)}catch(e){}})}):o.uploadProblemFeedbackData(g.uploadData,function(e){if("success"==e)i.goBack();else if("failed"==e)try{var t={};t.date=moment().format("YYYY/MM/DD/HH:mm:ss"),t.address=g.problemDetails.name,t.type="problemFeedbackDetails",t.data=JSON.stringify(g.uploadData),c.insertDataToSqlDB(g.db,t)}catch(e){}})}function d(){""!=g.uploadData.img&&n.confirm({title:"提示",template:"确认删除此照片么？",cancelText:"取消",cancelType:"button-royal",okText:"确认",okType:"button-positive"}).then(function(e){if(e){g.uploadData.img="";var t=document.getElementById("problemFeedbackDetailsImg");t.src="assets/global/img/gridCheck/icon_streetscape.jpg"}})}function m(){r.go("problemFeedbackDetailsMap")}var g=this;g.db,g.title="问题详情",g.fromWhere="",g.data={},g.problemDetails={id:"",planId:""},g.footerContent="确定",g.fun={initCamera:u,uploadProblemFeedbackData:p,deletePic:d,toProblemFeedbackDetailsMap:m},g.uploadData={id:"",planId:"",feedbackDescription:"",feedbackUser:"",img:""},g.imgPath="",l()}angular.module("app.problemFeedbackDetails").controller("ProblemFeedbackDetailsController",e),e.$inject=["$scope","$rootScope","$stateParams","ProblemFeedbackDetailsService","$ionicPopup","$ionicHistory","$cordovaCamera","$state","HomeService"]}(),function(){"use strict";function e(e){e.state("problemFeedbackDetails",{url:"/problemFeedbackDetails",params:{problemItem:null,fromWhere:""},templateUrl:"templates/problemFeedback/problemFeedbackDetails/problemFeedbackDetails.html"})}angular.module("app.problemFeedbackDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){function a(e){console.log("问题饭详情页面的相关数据"),console.log(e);var a=t.getPositionArray(e.point);a=a.length<=0?null:a[0],console.log("问题饭详情页面设施坐标"),console.log(a);var o=new AMap.Map("problemFeedbackDetailsMap",{resizeEnable:!0,zoom:15,center:a});new AMap.Marker({position:a,map:o});o.plugin(["AMap.ToolBar"],function(){var e=new AMap.ToolBar;o.addControl(e)})}function o(t,a){var o="/hwweb/GridInspection/CheckProblemById.action?planId="+t.id;e.getCommonData(o,a)}function n(t,a){var o="/hwweb/GridInspection/UploadProblem.action",n=JSON.stringify(t);e.uploadCommonData(o,n,a)}var i={getProblemFeedbackDetailsMap:a,uploadProblemFeedbackData:n,getProblemDetailsData:o};return i}angular.module("app.problemFeedbackDetails").service("ProblemFeedbackDetailsService",e),e.$inject=["MyHttpService","AddAssessmentMapService"]}(),function(){"use strict";function e(e){function t(){o.map=e.initMap(),e.getCoordinateInfo(function(t){o.position=t,o.map.setZoom(15),o.marker=e.initMyPosition(o.map,t)})}function a(){e.getCoordinateInfo(function(e){o.position=e,o.marker.setPosition(e),o.map.setZoom(15),o.map.setCenter(e)})}var o=this;o.title="问题详情地图",o.map,o.marker,o.address="",o.position,o.fun={refreshMyPosition:a},t()}angular.module("app.problemFeedbackDetailsMap").controller("ProblemFeedbackDetailsMapController",e),e.$inject=["CommonMapService"]}(),function(){"use strict";function e(e){e.state("problemFeedbackDetailsMap",{url:"/problemFeedbackDetailsMap",cache:!0,templateUrl:"templates/problemFeedback/problemFeedbackDetailsMap/problemFeedbackDetailsMap.html"})}angular.module("app.problemFeedbackDetailsMap").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i){function s(){switch(o.from?u.from=o.from:u.from="addAssessment",u.from){case"addAssessment":o.mapPositionObj&&(console.log(o.mapPositionObj),o.mapPositionObj.name&&(u.mapPositionObj.address=o.mapPositionObj.name),u.mapPositionObj.position=i.getPositionArray(o.mapPositionObj.point)),console.log(u.mapPositionObj);break;case"assessmentStatusDetails":o.mapPositionObj&&(console.log(o.mapPositionObj),u.mapPositionObj.address=o.mapPositionObj.name,u.mapPositionObj.position=i.getPositionArray(o.mapPositionObj.point)),console.log(u.mapPositionObj)}r()}function r(){if(u.map=n.initMap(),u.markerPerson=new AMap.Marker,n.getCoordinateInfo(function(e){u.markerPerson.setPosition(e),u.markerPerson.setMap(u.map)}),1==u.mapPositionObj.position.length){var e=new AMap.Icon({size:new AMap.Size(20,25),image:"assets/global/map/marker.png",imageOffset:new AMap.Pixel(0,0)});u.marker=new AMap.Marker({position:u.mapPositionObj.position[0],icon:e}),u.marker.setMap(u.map),u.map.setCenter(u.mapPositionObj.position[0])}else u.mapPositionObj.position.length>1&&(console.log("走到这里了"),u.polyline=new AMap.Polyline({path:u.mapPositionObj.position,strokeColor:"#1C8B08",strokeWeight:5}),u.polyline.setMap(u.map),u.map.setZoom(13),u.centerPositionNum=parseInt(u.mapPositionObj.position.length/2),u.map.setCenter(u.mapPositionObj.position[u.centerPositionNum]))}function c(){n.getCoordinateInfo(function(e){u.markerPerson.setPosition(e),u.map.setZoom(13),u.markerPerson.setMap(u.map),u.map.setCenter(e)})}function l(){1==u.mapPositionObj.position.length?u.map.setCenter(u.mapPositionObj.position[0]):u.mapPositionObj.position.length>1&&u.map.setCenter(u.mapPositionObj.position[u.centerPositionNum])}var u=this;u.data={},u.title="地图详情",u.from="",u.map,u.marker,u.markerPerson,u.polyline,u.centerPositionNum=0,u.fun={refreshMyPosition:c,refreshRoadOrInstallationPosition:l},u.mapPositionObj={address:"",position:[]},s()}angular.module("app.addAssessment").controller("AddAssessmentMapController",e),e.$inject=["$rootScope","$scope","$state","$stateParams","CommonMapService","AddAssessmentMapService"]}(),function(){"use strict";function e(e){e.state("addAssessmentMap",{url:"/addAssessmentMap",params:{mapPositionObj:null,from:null},cache:!0,templateUrl:"templates/assessment/addAssessment/addAssessmentMap/addAssessmentMap.html"})}angular.module("app.addAssessmentMap").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(){function e(){}function t(e){var t=[];if(e&&e.indexOf(",")>=0){for(var a=e.split(","),o=0;o<a.length-1;o+=2){var n=new Array;n[0]=a[o],n[1]=a[o+1],t.push(n)}return t}return t}var a={initAddAssessmentMap:e,getPositionArray:t};return a}angular.module("app.addAssessmentMap").service("AddAssessmentMapService",e),e.$inject=[]}();