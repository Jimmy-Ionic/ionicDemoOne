!function(){"use strict";function e(e,t,a,o,n,i,s,r){function c(){console.log("done"),console.log(a.unReadMsgCount)}function l(){console.log("循环获取获取消息error")}function u(){}function p(){i.goBack()}function d(){s.go("recMessage")}a.unReadMsgCount=0,a.goBack=p,a.toMessagePage=d;var m=t.SERVER_PATH+":"+t.SERVER_PORT+"/hwweb/AppMessage/findMsgByUserId.action?userId=123";r.setServerInfo();var g=o(function(){n.get(m).then(function(e){1==e.data.success&&(a.unReadMsgCount=e.data.data.count)},function(e){})},3e5);g.then(c,l,u)}function t(e,t,a,o,n){a.ready(function(){if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),window.codePush){var t;e.downloadMsg="";var a=function(e){t.close(),n.alert({title:"更新提示",template:"更新失败！"})},o=function(){t.close(),n.alert({title:"更新提示",template:"更新成功！"}).then(function(){codePush.restartApplication()})},i=function(e){return(e/1024).toFixed(2)},s=function(t){e.downloadMsg=i(t.receivedBytes)+"kb 共"+i(t.totalBytes)+"kb"},r=function(e){e.install(o,a,{installMode:InstallMode.ON_NEXT_RESUME,minimumBackgroundDuration:120,mandatoryInstallMode:InstallMode.ON_NEXT_RESTART})},c=function(o){o&&!o.failedInstall&&n.confirm({title:"更新提示",template:"有可用的新版本，是否需要更新？",cancelText:"否",okText:"是"}).then(function(i){i&&(t=n.show({template:"<span>正在下载 {{downloadMsg}}</span>",scope:e,title:"更新提示"}),o.download(r,a,s))})};window.codePush.checkForUpdate(c,a)}}),a.registerBackButtonAction(function(e){e.preventDefault();var a=t.path();return"/homePageNew"===a||"/login"===a?ionic.Platform.exitApp():o.backView?o.goBack():ionic.Platform.exitApp(),!1},101)}function a(e,t,a){a.platform.ios.tabs.style("standard"),a.platform.ios.tabs.position("bottom"),a.platform.android.tabs.style("standard"),a.platform.android.tabs.position("standard"),a.platform.ios.navBar.alignTitle("center"),a.platform.android.navBar.alignTitle("left"),a.platform.ios.backButton.previousTitleText("").icon("ion-ios-arrow-thin-left"),a.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),a.platform.ios.views.transition("ios"),a.platform.android.views.transition("android"),t.otherwise("/login")}a.$inject=["$stateProvider","$urlRouterProvider","$ionicConfigProvider"],e.$inject=["$scope","SYS_INFO","$rootScope","$interval","$http","$ionicHistory","$state","LoginService"],angular.module("app",["ionic","ngStorage","ngFileUpload","ng-echarts","ngCordova","app.login","app.home","app.savedData","app.waitForWork","app.assessment","app.planDetails","app.assessmentStatus","app.assessmentStatusDetails","app.addAssessment","app.addAssessmentMap","app.gridCheck","app.gridCheckMap","app.problemFeedback","app.problemFeedbackDetails","app.account","app.accountDetails","app.history","app.map","app.appReceivedMessage","app.messageContent","app.setting","app.setNet","app.commonHttpService","app.commonMap"]).run(t).config(a).constant("SYS_INFO",{SERVER_PATH:"http://172.72.100.61",SERVER_PORT:"8090",VERSION:"1.0.0",DIGITS:2}).controller("AppController",e),e.$inject.LoginService,t.$inject=["$rootScope","$location","$ionicPlatform","$ionicHistory","$ionicPopup"]}(),function(){"use strict";angular.module("app.account",[])}(),function(){"use strict";angular.module("app.assessment",[])}(),function(){"use strict";angular.module("app.gridCheck",[])}(),function(){"use strict";angular.module("app.home",[])}(),function(){"use strict";angular.module("app.history",[])}(),function(){"use strict";angular.module("app.appReceivedMessage",[])}(),function(){"use strict";angular.module("app.map",[])}(),function(){"use strict";angular.module("app.login",[])}(),function(){"use strict";angular.module("app.problemFeedback",[])}(),function(){"use strict";angular.module("app.setNet",[])}(),function(){"use strict";angular.module("app.setting",[])}(),function(){"use strict";angular.module("app.waitForWork",[])}(),function(){"use strict";angular.module("app.accountDetails",[])}(),function(){"use strict";angular.module("app.commonMap",[])}(),function(){"use strict";angular.module("app.commonHttpService",[])}(),function(){"use strict";angular.module("app.addAssessment",[])}(),function(){"use strict";angular.module("app.assessmentStatus",[])}(),function(){"use strict";angular.module("app.assessmentStatusDetails",[])}(),function(){"use strict";angular.module("app.planDetails",[])}(),function(){"use strict";angular.module("app.gridCheckMap",[])}(),function(){"use strict";angular.module("app.savedData",[])}(),function(){"use strict";angular.module("app.messageContent",[])}(),function(){"use strict";angular.module("app.problemFeedbackDetails",[])}(),function(){"use strict";angular.module("app.addAssessmentMap",[])}(),function(){"use strict";function e(e,t,a){function o(){n()}function n(){t.getQueryCriteriaList(function(e){c.queryCriteriaObj=e[0]})}function i(){c.accountType&&""!=c.accountType&&(""==c.accountType?c.queryCriteria.accountType="":c.queryCriteria.accountType=JSON.parse(c.accountType).code),t.getAccountListByQueryCriteria(c.queryCriteria,function(e){c.accountList=e[0]})}function s(e){e&&(c.levelList=JSON.parse(e).subclass)}function r(e,t){a.go("accountDetails",{accountData:e,code:t})}var c=this;c.title="环卫台帐",c.optionAll='{"code":"", "id": "", "name": "全部类型", "subclass": []}',c.queryCriteriaObj={},c.accountType,c.levelList=[],c.queryCriteria={cityPlace:"",accountType:"",level:"",keyword:""},c.accountList=[],c.fun={updateLevelArrayByType:s,getAccountListByQueryCriteria:i,toAccountDetails:r},o()}angular.module("app.account").controller("AccountController",e),e.$inject=["$scope","AccountService","$state"]}(),function(){"use strict";function e(e){e.state("account",{url:"/account",cache:!0,templateUrl:"templates/account/account.html"})}angular.module("app.account").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){function a(e){var a="";t.getCommonData(a,e)}function o(e,a){var o="/hwweb/Ledger/findFacilitiesByCondition.action?areaId="+e.cityPlace+"&code="+e.accountType+"&subclassId="+e.level+"&name="+e.keyword;t.getCommonData(o,a)}function n(e){var a="/hwweb/Ledger/findAllAreaAndItem.action";t.getCommonData(a,e)}var i={getAccountList:a,getAccountListByQueryCriteria:o,getQueryCriteriaList:n};return i}angular.module("app.account").service("AccountService",e),e.$inject=["$http","MyHttpService"]}(),function(){"use strict";function e(e,t,a,o){function n(){o.getPlanList(e.userId,function(e){s.planList=e})}function i(e){a.go("planDetails",{planDetailsData:e,fromWhere:"assessment"})}var s=this;s.title="综合考核",s.titleController={},s.toPlanDetails=i,s.planList=[],n()}angular.module("app.assessment").controller("AssessmentController",e),e.$inject=["$rootScope","$scope","$state","AssessmentService"]}(),function(){"use strict";function e(e){e.state("assessment",{url:"/assessment",templateUrl:"templates/assessment/assessment.html"})}angular.module("app.assessment").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a){function o(e,t){var o="/hwweb/Comprehensive/findDataByUserId.action?userId="+e;a.getCommonData(o,t)}var n={getPlanList:o};return n}angular.module("app.assessment").service("AssessmentService",e),e.$inject=["$http","SYS_INFO","MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r){function c(){n.getGridCheckQuestionCodeArray(function(e){m.questionCode=e,m.questionCodeObj=m.questionCode[0],console.log(m.questionCode)})}function l(){o.go("gridCheckMap")}function u(){var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,popoverOptions:Camera.PopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};r.getPicture(e).then(function(e){var t=document.getElementById("gridCheckImg");t.src="data:image/jpeg;base64,"+e,m.imgName=moment().format("YYYY-MM-DD HH:mm:ss")+".jpeg",m.uploadData.img=e},function(e){s.alert({title:"照片获取失败，请重新拍照!"})})}function p(){i.getAddressByGPS(function(e){m.uploadData.areaName=e.district,m.uploadData.streetName=e.street,a.$apply()})}function d(){if(m.uploadData.examiner=e.userName,t.get("cacheGridCheckMapData")&&(m.uploadData.point=t.get("cacheGridCheckMapData").get("position"),m.uploadData.address=t.get("cacheGridCheckMapData").get("address")),m.uploadData.problemCode=m.questionCodeObj.id,m.uploadData.problemName=m.questionCodeObj.name,console.log("网格化巡检需要上传的数据："),console.log(m.uploadData),""==m.uploadData.areaName)s.alert({title:"市区不能为空！"}).then();else if(""==m.uploadData.streetName)s.alert({title:"街道不能为空！"}).then();else if(""==m.uploadData.problemCode||null==m.uploadData.problemCode)s.alert({title:"问题代码不能为空！"});else if(""==m.uploadData.problemName||null==m.uploadData.problemName)s.alert({title:"问题代码不能为空！"});else if(""==m.uploadData.point||""==m.uploadData.address)s.alert({title:"详细检查地点不能为空"}).then();else{var a=JSON.stringify(m.uploadData);n.uploadGridCheckData(a,function(e){})}}var m=this;m.title="网格化巡检",m.questionCode=[],m.questionCodeObj={},m.imgName="",m.uploadData={examiner:"",areaName:"",streetName:"",problemCode:"",problemName:"",description:"",location:"",point:[],img:""},m.fun={toGridCheckMap:l,takeGridCheckPicture:u,getGridCheckLocation:p,uploadGridCheckData:d},c()}angular.module("app.gridCheck").controller("GridCheckController",e),e.$inject=["$rootScope","$cacheFactory","$scope","$state","GridCheckService","CommonMapService","$ionicPopup","$cordovaCamera"]}(),function(){"use strict";function e(e){e.state("gridCheck",{url:"/gridCheck",cache:!1,templateUrl:"templates/gridCheck/gridCheck.html"})}angular.module("app.gridCheck").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t){var a='/hwweb/AssignmentAssessment/findDItem.action?typeId=""';e.getCommonData(a,t)}function a(t,a){var o="/hwweb/GridInspection/saveRegionPro.action";e.uploadCommonData(o,t,a)}var o={getGridCheckQuestionCodeArray:t,uploadGridCheckData:a};return o}angular.module("app.gridCheck").service("GridCheckService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c,l,u,p){function d(){r.getWeather(function(e){b.weather=e}),b.savedData=i.getSavedUploadedData(),b.savedData&&(b.hasSavedData=!0,b.saveDataNum=b.savedData.length)}function m(){b.isCommonAccount?p.alert({title:"提示",template:"公共账户无法查看代办工作"}):o.go("waitForWork")}function g(){o.go("assessment")}function f(){o.go("gridCheck")}function h(){o.go("problemFeedback")}function v(){o.go("account")}function D(){o.go("history")}function y(){o.go("map")}function A(){o.go("recMessage")}function P(){o.go("setting")}function S(){o.go("savedData")}var b=this;b.title="请选择工作",b.hasSavedData=!0,b.saveDataNum="20",b.savedData={},b.isCommonAccount=e.isCommonAccount,b.weather={},b.msgCount=e.unReadMsgCount,b.homeWorkController={toWaitForWork:m,toComprehensiveAssessment:g,toGridCheck:f,toProblemFeedback:h,toAccount:v,toHistory:D,toMap:y,toMessage:A,toSettings:P,toSavedData:S},d()}angular.module("app.home").controller("HomeController",e),e.$inject=["$rootScope","$localStorage","$scope","$state","$filter","HomeService","SYS_INFO","GetWeatherService","$stateParams","$interval","$cordovaCamera","$ionicPopup"]}(),function(){"use strict";function e(e){e.state("home",{url:"/home",cache:!0,templateUrl:"templates/home/home.html"})}angular.module("app.home").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){return e.savedData?e.savedData:null}var s={getSavedUploadedData:i};return s}function t(e,t){function a(t){e.get(n).then(function(e){e.data?(i.weatherDate=moment().format("MM月DD日"),i.address="青岛",i.temperature=o(e.data),i.weather=e.data.data.forecast[0].type,t(i)):(i.weatherDate=moment().format("MM月DD日"),i.address="青岛",i.temperature="20度",i.weather="晴",t(i))},function(e){i.weatherDate=moment().format("MM月DD日"),i.address="青岛",i.temperature="20度",i.weather="晴",t(i)}),console.log(i)}function o(e){if(e.data){var t=e.data.forecast[0].low.substring(3,5),a=e.data.forecast[0].high.substring(3,5),o=t+"~"+a+"℃";return o}return""}var n=t.SERVER_PATH+":"+t.SERVER_PORT+"/hwweb/Weather/WeatherJson.action",i={},s={getWeather:a};return s}angular.module("app.home").service("GetWeatherService",t).factory("HomeService",e),e.$inject=["$localStorage","$http","SYS_INFO","$interval","$rootScope"],t.$inject=["$http","SYS_INFO","$interval"]}(),function(){"use strict";function e(e,t,a,o){function n(){for(var e=0;e<12;e++)r.monthArray[e]=e+1;console.log(r.monthArray);for(var e=0;e<5;e++)r.yeahArray[e]=r.thisYeah-e;var t={keyword:"",selectedYeah:r.thisYeah,selectedMonth:r.thisMonth};o.getHistoryDataByCondition(t,function(e){r.historyList=e})}function i(e){a.go("planDetails",{assessmentData:e,fromWhere:"history"})}function s(){o.getHistoryDataByCondition(r.queryCriteria,function(e){r.historyList=e})}var r=this;r.title="历史考核记录",r.fun={toPlanDetails:i,getHistoryDataByCondition:s},r.toPlanDetails=i,r.historyList=[],r.yeahArray=[],r.monthArray=[],r.thisYeah=moment().format("YYYY"),r.thisMonth=moment().format("M"),r.queryCriteria={keyword:"",selectedYeah:"",selectedMonth:""},n()}angular.module("app.history").controller("HistoryController",e),e.$inject=["$rootScope","$scope","$state","HistoryService"]}(),function(){"use strict";function e(e){e.state("history",{url:"/history",templateUrl:"templates/history/history.html"})}angular.module("app.history").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/Comprehensive/viewHistory.action?name="+t.keyword+"&year="+t.selectedYeah+"&month="+t.selectedMonth;e.getCommonData(o,a)}var a={getHistoryDataByCondition:t};return a}angular.module("app.history").service("HistoryService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a){function o(){t.getMessagesByUserId(a.userId,function(e){r.messages=e})}function n(e){}function i(){r.messages=[];var o="";a.userId&&(o=a.userId),t.doRefresh(o,function(e){r.messages=e,console.log(r.messages)},function(){e.$broadcast("scroll.refreshComplete")})}function s(e){}var r=this;r.title="已收到消息",r.refreshMessageList=i,r.openMsgContent=n,r.fun={refreshMessageList:i,toMessageContent:s},r.messages=[],o()}angular.module("app.appReceivedMessage").controller("MessageController",e),e.$inject=["$scope","MessageService","$rootScope"]}(),function(){"use strict";function e(e){e.state("recMessage",{url:"/recMessage",templateUrl:"templates/message/recMessage.html"})}angular.module("app.appReceivedMessage").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a){function o(t,a){var o="/hwweb/AppMessage/findMsgByUserId.action?userId=123";e.getCommonData(o,a)}function n(e,o,n){var i=t.SERVER_PATH+":"+t.SERVER_PORT+"/hwweb/AppMessage/findMsgByUserId.action?userId=123";a.get(i).success(function(e){o(e.data)}).finally(function(){n()})}var i={getMessagesByUserId:o,doRefresh:n};return i}angular.module("app.appReceivedMessage").service("MessageService",e),e.$inject=["MyHttpService","SYS_INFO","$http"]}(),function(){"use strict";function e(e,t,a,o){function n(){s(),t.getAccountList(c.queryCriteria,function(e){if(c.mapPositionObj=e[0],c.mapPositionObj){if(c.mapPositionObj.daolu)for(var t in c.mapPositionObj.daolu){var a=o.getPositionArray(c.mapPositionObj.daolu[t].point);c.polyline=new AMap.Polyline({path:a,strokeColor:"#1C8B08",strokeWeight:5}),c.polyline.setMap(c.map)}if(c.mapPositionObj.guojietianqiao)for(var t in c.mapPositionObj.guojietianqiao){var n={name:c.mapPositionObj.guojietianqiao[t].bridgeName},a=o.getPositionArray(c.mapPositionObj.guojietianqiao[t].point);a.length>0&&(a=a[0],console.log("过街天桥"),console.log(a)),new AMap.Marker({position:a,extData:n,content:'<div style="background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;"></div>',offset:new AMap.Pixel((-15),(-15)),map:c.map}).on("click",i)}if(c.mapPositionObj.shoujizhan)for(var t in c.mapPositionObj.shoujizhan){var a=o.getPositionArray(c.mapPositionObj.shoujizhan[t].point),n={name:c.mapPositionObj.shoujizhan[t].RCPsname};a.length>0&&(a=a[0],console.log("收集站"),console.log(a)),new AMap.Marker({position:a,extData:n,content:'<div style="background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;"></div>',offset:new AMap.Pixel((-15),(-15)),map:c.map}).on("click",i)}}})}function i(e){var t=[];t.push("<div>"+e.target.getExtData().name+"</div>");var a=new AMap.InfoWindow({content:t.join("<br/>")});a.open(c.map,e.target.getPosition())}function s(){c.map=e.initMap(),c.map.setZoom(17),c.markerPerson=new AMap.Marker,e.getCoordinateInfo(function(e){c.map.setCenter(e),c.markerPerson.setPosition(e),c.map.setZoom(17),c.markerPerson.setMap(c.map),c.circle=new AMap.Circle({center:e,radius:50,strokeColor:"#F85C5C",strokeOpacity:1,strokeWeight:0,fillColor:"#F85C5C",fillOpacity:.35}),c.circle.setMap(c.map)})}function r(){console.log(c.accountList),c.queryCriteria.type="";for(var e in c.accountList)c.accountList[e].selected&&(c.queryCriteria.type+=c.accountList[e].code+",",console.log(c.queryCriteria));6==c.queryCriteria.type.split(",").length?c.queryCriteria.type="":(c.queryCriteria.type=c.queryCriteria.type.substring(0,c.queryCriteria.type.length-1),console.log(c.queryCriteria.type)),console.log(c.queryCriteria.type);var a=c.queryCriteria;t.getAccountList(a,function(e){c.mapPositionObj=e})}var c=this;c.title="地图查询",c.queryCriteria={type:"",keyword:""},c.allCheck={account:"全部",selected:!0,code:""},c.accountList=[{id:"0",account:"公厕",selected:!0,code:"gongche"},{id:"1",account:"道路",selected:!0,code:"jiedao"},{id:"2",account:"车辆",selected:!0,code:"cheliang"},{id:"3",account:"垃圾桶",selected:!0,code:"lajitong"},{id:"4",account:"收集站",selected:!0,code:"shoujizhan"},{id:"5",account:"过街天桥",selected:!0,code:"guojietianqiao"}],c.map,c.marker,c.cluster,c.markerPerson,c.circle,c.polyline,c.markers=[],c.centerPositionNum=0,c.mapPositionObj={},c.fun={getAccountsPositionData:r},n()}angular.module("app.map").controller("MapController",e),e.$inject=["CommonMapService","MapService","$ionicPopup","AddAssessmentMapService"]}(),function(){"use strict";function e(e){e.state("map",{url:"/map",templateUrl:"templates/map/map.html"})}angular.module("app.map").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/Ledger/findMap.action?code="+t.type+"&name="+t.keyword;e.getCommonData(o,a)}var a={getAccountList:t};return a}angular.module("app.map").service("MapService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){}function s(){t.go("setNet",{imei:e.imei})}function r(){a.login(e.info.userName,e.info.password,e.imei,e.isCommonAccount,e.info.isRemAccountAndPwd,e.info)}e.doLogin=r,e.setNetAddress=s,e.isCommonAccount=!1,e.userInfo=a.getUserInfo(),e.imei="",e.info={userName:e.userInfo.userName,password:e.userInfo.password,isRemAccountAndPwd:e.userInfo.isRemAccountAndPwd},i(),a.setServerInfo()}var t=angular.module("app.login");t.controller("LoginController",e),e.$inject=["$scope","$state","LoginService","$cordovaDevice","$ionicPopup"]}(),function(){function e(e){e.state("login",{url:"/login",cache:!1,templateUrl:"templates/login/login.html"})}angular.module("app.login").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c){function l(e,i,r,c,l,d){n.show({template:"正在登录..."}),o(function(){n.hide()},3e4),i=hex_md5(i);var m="/hwweb/AppUser/userLogin.action?";switch(c){case!1:t.get(a.SERVER_PATH+":"+a.SERVER_PORT+m+"account="+e+"&password="+i+"&imei="+r).then(function(e){s.isCommonAccount=!1,u(e,l,d)},function(e){p(e)});break;case!0:t.get(a.SERVER_PATH+":"+a.SERVER_PORT+m+"account="+e+"&password="+i).then(function(e){s.isCommonAccount=!0,u(e,l,d)},function(e){p(e)})}}function u(e,t,a){console.log(e),"1"==e.data.success?o(function(){t?m(a):h(),d(e.data.data[0])},100).then(function(){n.hide(),c.go("home")}):(n.hide(),i.alert({title:e.data.msg}).then(function(e){}))}function p(e){n.hide(),i.alert({title:"登陆失败",template:e.data}).then(function(e){})}function d(e){e?(s.userId=e.id,s.userName=e.name,s.userOrg=e.org):(s.userId="",s.userName="",s.userOrg="")}function m(t){var a={userName:"",password:"",isRemAccountAndPwd:!1};t&&(a.userName=t.userName,a.password=t.password,a.isRemAccountAndPwd=t.isRemAccountAndPwd),e.userInfo=a}function g(){function e(){return r.getUUID()}document.addEventListener("deviceready",e,!1)}function f(){var t={userName:"",password:"",isRemAccountAndPwd:!1};return e.userInfo&&(t.userName=e.userInfo.userName,t.password=e.userInfo.password,t.isRemAccountAndPwd=e.userInfo.isRemAccountAndPwd),t}function h(){delete e.userInfo}function v(){var t={SERVER_PATH:"",SERVER_PORT:""};e.serverInfo?(a.SERVER_PATH=e.serverInfo.SERVER_PATH,a.SERVER_PORT=e.serverInfo.SERVER_PORT):(t.SERVER_PATH=a.SERVER_PATH,t.SERVER_PORT=a.SERVER_PORT,e.serverInfo=t)}var D={login:l,getUserInfo:f,setServerInfo:v,getImei:g};return D}angular.module("app.login").service("LoginService",e),e.$inject=["$localStorage","$http","SYS_INFO","$timeout","$ionicLoading","$ionicPopup","$rootScope","$cordovaDevice","$state"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){n.getProblemList(e.userId,function(e){l.problemList=e})}function s(e){c(e)}function r(e){c(e)}function c(e){t.go("problemFeedbackDetails",{problemItem:e,fromWhere:"problemFeedback"})}var l=this;l.title="已收到的检查问题",l.fun={checkProblemDetails:s,feedbackProblem:r},l.problemList=[],i()}angular.module("app.problemFeedback").controller("ProblemFeedbackController",e),e.$inject=["$rootScope","$state","$ionicPopup","$scope","ProblemFeedbackService"]}(),function(){"use strict";function e(e){e.state("problemFeedback",{url:"/problemFeedback",templateUrl:"templates/problemFeedback/problemFeedback.html"})}angular.module("app.problemFeedback").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/GridInspection/CheckProblem.action?userId="+t;e.getCommonData(o,a)}var a={getProblemList:t};return a}angular.module("app.problemFeedback").service("ProblemFeedbackService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n){e.netSetList=[{placeholderValue:"服务器地址：",value:a.SERVER_PATH},{placeholderValue:"服务器端口：",value:a.SERVER_PORT}],n.imei&&(e.IMEI=n.imei),e.setNet=function(){t.saveNetSettings(e.netSetList[0].value,e.netSetList[1].value,function(){o.goBack()})},e.backToLogin=function(){o.goBack()}}angular.module("app.setNet").controller("SetNetController",e),e.$inject=["$scope","SetNetService","SYS_INFO","$ionicHistory","$stateParams"]}(),function(){function e(e){e.state("setNet",{url:"/setNet",params:{imei:""},cache:!1,controller:"SetNetController",templateUrl:"templates/setNet/net.html"})}angular.module("app.setNet").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){function a(a,o,n){var i={SERVER_PATH:a,SERVER_PORT:o};e.serverInfo=i,t.SERVER_PATH=i.SERVER_PATH,t.SERVER_PORT=i.SERVER_PORT,n()}var o={saveNetSettings:a};return o}angular.module("app.setNet").service("SetNetService",e),e.$inject=["$localStorage","SYS_INFO"]}(),function(){"use strict";function e(e,t,a){function o(){a.getWeather(function(e){n.weather=e})}var n=this;n.title="个人信息",n.group=e.userOrg,n.name=e.userName,n.weather={},o()}angular.module("app.setting").controller("SettingController",e),e.$inject=["$rootScope","$scope","GetWeatherService"]}(),function(){"use strict";function e(e){e.state("setting",{url:"/setting",templateUrl:"templates/setting/setting.html"})}angular.module("app.setting").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){var t={};return t}angular.module("app.setting").service("userInfoService",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,a,o){function n(){console.log(a.userId),t.getWaitForWorkInfo(a.userId,function(e){s.workList=e,console.log(s.workList)})}function i(e){"无"==e.sDate?o.go("problemFeedbackDetails",{problemItem:e,fromWhere:"waitForWork"}):o.go("planDetails",{planDetailsData:e,fromWhere:"waitForWork"})}var s=this;s.title="待办工作",s.titleController={},s.workList=[],s.toJobDetails=i,n()}angular.module("app.waitForWork").controller("WaitForWorkController",e),e.$inject=["$scope","WaitForWorkService","$rootScope","$state"]}(),function(){"use strict";function e(e){e.state("waitForWork",{url:"/waitForWork",cache:!0,templateUrl:"templates/waitForWork/waitForWork.html"})}angular.module("app.waitForWork").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c,l){function u(t,a){var o="/hwweb/AssignmentAssessment/findDataByUserId?userId="+t;e.getCommonData(o,a)}var p={getWaitForWorkInfo:u};return p}angular.module("app.waitForWork").service("WaitForWorkService",e),e.$inject=["MyHttpService","$localStorage","$http","SYS_INFO","$timeout","$ionicLoading","$ionicPopup","$rootScope","$cordovaDevice","$state"]}(),function(){"use strict";function e(e,t,a){function o(){null!=a.accountData&&(n.accountDetailsData=a.accountData),null!=a.code&&(n.code=a.code)}var n=this;n.data={},n.installationName="",n.code="",n.accountDetailsData={},o()}angular.module("app.accountDetails").controller("AccountDetailsController",e),e.$inject=["$scope","AccountDetailsService","$stateParams"]}(),function(){"use strict";function e(e){e.state("accountDetails",{url:"/accountDetails",params:{accountData:null,code:null},cache:!0,templateUrl:"templates/account/accountDetails/accountDetails.html"})}angular.module("app.accountDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){var a={};return a}angular.module("app.accountDetails").service("AccountDetailsService",e),e.$inject=["$http","MyHttpService"]}(),function(){"use strict";function e(e,t,a,o){function n(){switch(r.fromWhere){case"gridCheck":null==r.data||void 0==r.data?o.initMap():(r.map=o.initMap(),o.getCoordinateInfo(function(e){r.marker=o.initMyPosition(r.map,e),r.map.on("click",function(e){marker.setPosition(e.lnglat),r.postion=e.lnglat,console.log(e.lnglat)})}));break;case"addAssessment":}}function i(){o.getCoordinateInfo(function(e){r.marker.setPosition(e),r.map.setZoom(12),r.map.setCenter(e)})}function s(){$state.go("gridCheck",{position:r.postion})}var r=this;r.data={},r.title="地图详情",r.fun={},r.data=a.data,r.fromWhere=a.from,r.map,r.marker,r.postion=[],r.fun={refreshMyPosition:i,sendPosition:s},n()}angular.module("app.commonMap").controller("CommonMapController",e),e.$inject=["$rootScope","$scope","$stateParams","CommonMapService"]}(),function(){"use strict";function e(e){e.state("commonMap",{url:"/commonMap",params:{data:null,from:""},templateUrl:"templates/common/map/commonMap.html"})}angular.module("app.commonMap").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){t.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>地图数据加载中...</span></div>',duration:5e3});var e=new AMap.Map("map",{resizeEnable:!0,zoom:12,lang:"zh_cn"});return e.plugin(["AMap.ToolBar"],function(){var t=new AMap.ToolBar;e.addControl(t)}),t.hide(),e}function s(e){t.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>地图数据加载中...</span></div>',duration:5e3});new AMap.Map("map");map.setZoom(10),map.setCenter([116.39,39.9]),t.hide()}function r(e,a){t.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>地图数据加载中...</span></div>',duration:2e4});var a=new AMap.LngLat(116.397428,39.90923);new AMap.Map("map",{view:new AMap.View2D({center:a,zoom:10,rotation:0}),lang:"zh_cn"});t.hide()}function c(e,t){e.setCenter(t);var a=new AMap.Marker({position:t});return a.setMap(e),a.setTitle("我的位置"),a}function l(e){t.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>定位中...</span></div>',duration:1e4});var a=new Array;n.getCurrentPosition({timeout:1e4,enableHighAccuracy:!1}).then(function(o){a[0]=o.coords.longitude,a[1]=o.coords.latitude,e(a),t.hide(),console.log("Cordova使用GPS定位成功："),console.log(a)},function(o){a[0]=120.413762,a[1]=36.084807,e(a),t.hide(),console.log("Cordova使用GPS定位失败，定位地点已经设为垃管处的地理位置："),console.log("失败码："+o.code),console.log("失败信息"+o.msg)})}function u(e){var t={};return AMap.plugin("AMap.Geocoder",function(){var a=new AMap.Geocoder({city:"010"});a.getAddress(e,function(e,a){return"complete"==e?(t.address=a.regeocode.formattedAddress,t.city=a.regeocode.addressComponent.city,t.district=a.regeocode.addressComponent.city+a.regeocode.addressComponent.district,t.street=a.regeocode.addressComponent.street,t.township=a.regeocode.addressComponent.township,t.streetNumber=a.regeocode.addressComponent.streetNumber,console.log("根据经纬度来获取定位地点返回的数据："),console.log(a),console.log("根据经纬度来获取定位地点的的各种信息:"),console.log(t),t):t})}),t}function p(e,t){var a="";AMap.plugin("AMap.Geocoder",function(){var o=new AMap.Geocoder({city:"010"});o.getAddress(e,function(e,o){"complete"==e?(a=o.regeocode.formattedAddress,t(a)):t(a),console.log("根据经纬度来获取详细的地理位置："),console.log(o)})})}function d(e){t.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>定位中...</span></div>',duration:1e4});var o=[];n.getCurrentPosition({timeout:1e4,enableHighAccuracy:!1}).then(function(a){o[0]=a.coords.longitude,o[1]=a.coords.latitude,t.hide(),console.log("定位成功，坐标数组："+o),AMap.plugin("AMap.Geocoder",function(){var t=new AMap.Geocoder({city:"010"});t.getAddress(o,function(t,a){if("complete"==t){var o={};o.district=a.regeocode.addressComponent.city+a.regeocode.addressComponent.district,o.street=a.regeocode.addressComponent.street,e(o),console.log("根据经纬度来获取定位地点返回的数据："),console.log(a),console.log("根据经纬度来获取定位地点的的各种信息:"),console.log(o)}else console.log("根据经纬度来获取定位地点失败！")})})},function(o){t.hide();var n={};n.district="",n.street="",e(n),a.alert({title:"定位失败，请重试！"})})}var m={initMap:i,initRoadMap:s,initInstallationMap:r,initMyPosition:c,getCoordinateInfo:l,getAddressByLatitudeAndLongitude:u,getAddressByGPS:d,getLocationByLatitudeAndLongitude:p};return m}angular.module("app.commonMap").service("CommonMapService",e),e.$inject=["$http","$ionicLoading","$ionicPopup","SYS_INFO","$cordovaGeolocation"]}(),function(){"use strict";function e(e,t,a,o){function n(n,i){console.log(o.SERVER_PATH+":"+o.SERVER_PORT+n);var s=[];t.show({templateUrl:"templates/common/common.loadingData.html",duration:2e4}),e({method:"GET",url:o.SERVER_PATH+":"+o.SERVER_PORT+n}).then(function(e){1==e.data.success?(t.hide(),s=e.data.data,console.log("数据获取成功"),console.log(s),i(s)):(t.hide(),a.alert({title:"提示",template:"获取数据失败"}).then(function(e){console.log("数据获取失败"),console.log(s),i(s)}))},function(e){t.hide(),a.alert({title:"提示",template:"获取数据失败"}).then(function(e){console.log("通信异常"),console.log(s),i(s)})})}function i(n,i,s){t.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>数据上传中...</span></div>',duration:1e4});var r=o.SERVER_PATH+":"+o.SERVER_PORT+n;console.log(r),console.log(i),e({method:"post",url:r,data:{data:i},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return console.log(t.join("&")),t.join("&")}}).then(function(e){if(e.data.success=1){var o=e.data.data;t.hide(),a.alert({title:"提示",template:e.data.msg}).then(function(e){s(o)})}else t.hide(),a.alert({title:"数据上传失败"})},function(e){t.hide(),a.alert({title:"数据上传失败"})})}var s={
getCommonData:n,uploadCommonData:i};return s}angular.module("app.commonHttpService").service("MyHttpService",e),e.$inject=["$http","$ionicLoading","$ionicPopup","SYS_INFO"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r){function c(){a.addAssessmentData&&(h.addAssessmentData=a.addAssessmentData),m()}function l(){t.go("addAssessmentMap",{mapPositionObj:h.mapPositionObj,from:"addAssessment"})}function u(){var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:100,targetHeight:100,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};r.getPicture(e).then(function(e){h.picBase64DataArray.splice(0,h.picBase64DataArray.length),h.uploadData.img.splice(0,h.uploadData.img.length),h.picBase64DataArray.push("data:image/jpeg;base64,"+e),h.uploadData.img.push(e)},function(e){i.alert({title:"拍照失败，请重试！"})})}function p(){o.queryAccountList(h.queryCriteria,function(e){h.accountList=e,e.length>0?h.spinnerShow=!0:h.spinnerShow=!1})}function d(e){switch(e.type){case"01":h.accountObj.wcCondition=e.condition;break;case"02":break;case"05":h.accountObj.level=e.cleanLevel,h.accountObj.length=e.length,h.accountObj.road=e.primaryOrSecondary,h.accountObj.width=e.width;break;case"06":h.accountObj.carCondition=e.condition}h.spinnerShow=!1,h.queryCriteria.address=e.name,h.mapPositionObj=e,h.infraId=e.id}function m(){n.getAccounts(null,function(e){h.pointReasonArray=e,h.uploadData.reason=h.pointReasonArray[0].name})}function g(e){i.confirm({title:"提示",template:"您确定要删除此照片么？"}).then(function(t){t&&(h.picBase64DataArray.splice(e,1),h.uploadData.img.splice(e,1))})}function f(){if(h.addAssessmentData&&h.addAssessmentData.id)if(h.infraId)if(""==h.uploadData.points)i.alert({title:"扣分情况不能为空"});else if(""==h.uploadData.reason)i.alert({title:"扣分原因不能为空"});else if(""==h.uploadData.remark)i.alert({title:"备注不能为空"});else{var t={planId:"",infraId:""};t.planId=h.addAssessmentData.id,t.infraId=h.infraId;var a=JSON.stringify(t);o.uploadAccountData(a,function(t){if(t){var a={infoId:"",planId:"",infraId:"",dItemName:"",score:"",userName:"",remark:"",imgJson:[]};a.infoId=t[0],a.planId=h.addAssessmentData.id,a.infraId=h.infraId,a.dItemName=h.uploadData.reason,a.score=h.uploadData.points,a.userName=e.userName,a.remark=h.uploadData.remark,a.imgJson=h.uploadData.img;var n=JSON.stringify(a);o.uploadPointAndPicData(n,function(e){})}})}else i.alert({title:"提示",template:"您没有选择相关的设施，请先选择！"});else i.alert({title:"提示",template:"计划id未获取到，请退出此页面重新进入！"})}var h=this;h.data={},h.title="录入计划",h.spinnerShow=!1,h.picBase64DataArray=[],h.infraId="",h.uploadData={level:"",road:"",length:"",points:"",width:"",reason:"",remark:"",img:[]},h.addAssessmentData={},h.queryCriteria={type:"",address:""},h.pointReasonArray=[],h.accountList=[],h.facilityTypeList=[{name:"公厕",type:"01"},{name:"转运站",type:"02"},{name:"道路",type:"05"},{name:"车辆",type:"06"}],h.accountObj={level:"",road:"",length:"",width:"",wcCondition:"",carCondition:""},h.mapPositionObj={},h.fun={toAddAssessmentMap:l,takePicture:u,spinnerHide:d,deletePic:g,queryAccountList:p,uploadDataFun:f},c()}angular.module("app.addAssessment").controller("AddAssessmentController",e),e.$inject=["$rootScope","$state","$stateParams","AddAssessmentService","AssessmentStatusDetailsService","$ionicPopup","$ionicHistory","$cordovaCamera"]}(),function(){"use strict";function e(e){e.state("addAssessment",{url:"/addAssessment",params:{addAssessmentData:null},templateUrl:"templates/assessment/addAssessment/addAssessment.html"})}angular.module("app.addAssessment").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i){function s(e,t,a,o){}function r(){document.addEventListener("deviceready",function(){var t={quality:50,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:100,targetHeight:100,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1,correctOrientation:!0};e.getPicture(t).then(function(e){var t=document.getElementById("myImage");t.src="data:image/jpeg;base64,"+e},function(e){})},!1)}function c(){document.addEventListener("deviceready",function(){var t={destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA};e.getPicture(t).then(function(e){var t=document.getElementById("myImage");t.src=e},function(e){}),e.cleanup().then()},!1)}function l(e,a){var o="/hwweb/Comprehensive/searchFacilities.action?name="+e.address+"&typeId="+e.type;t.getCommonData(o,a)}function u(e,t){a.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>数据上传中...</span></div>',duration:1e4});var s=o.SERVER_PATH+":"+o.SERVER_PORT+"/hwweb/AssignmentAssessment/comprehensive.action";console.log(s),console.log(e),n({method:"post",url:s,data:{data:e},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}}).then(function(e){if(e.data.success=1){var o=e.data.data;a.hide(),t(o)}else a.hide(),i.alert({title:"数据上传失败"})},function(e){a.hide(),i.alert({title:"数据上传失败"})})}function p(e,a){var o="/hwweb/AssignmentAssessment/reportPro.action";t.uploadCommonData(o,e,a)}var d={addNewAssessment:s,getPhonePictureData:r,getPhonePicturePath:c,queryAccountList:l,uploadAccountData:u,uploadPointAndPicData:p};return d}angular.module("app.addAssessment").service("AddAssessmentService",e),e.$inject=["$cordovaCamera","MyHttpService","$ionicLoading","SYS_INFO","$http","$ionicPopup"]}(),function(){"use strict";function e(e,t,a,o,n,i,s){function r(){o.planDetailsData&&(p.data=o.planDetailsData,console.log(p.data),n.getAssessmentStatusList(p.data,function(e){p.assessmentStatusList=e})),t.$on("$ionicView.beforeEnter",function(e){n.getAssessmentStatusList(p.data,function(e){p.assessmentStatusList=e})})}function c(){null!=p.data&&(null==p.data.status||0==p.data.status?n.checkOverAndUpload(p.data):s.alert({title:"该考核任务已经完成！"}).then(function(e){}))}function l(){null!=p.data&&(null==p.data.status||0==p.data.status?a.go("assessmentStatusDetails",{assessmentStatusData:p.data,isEdit:!0}):s.alert({title:"该考核任务已经完成！"}).then(function(e){}))}function u(e){e.typeId=p.data.typeId,e.infraId=p.data.infraId,a.go("assessmentStatusDetails",{assessmentStatusData:e,isEdit:!1})}var p=this;p.title="考核情况",p.data={},p.fun={toAssessmentStatusDetails:l,upload:c,checkStatusDetails:u},p.assessmentStatusList=[],r()}angular.module("app.assessmentStatus").controller("AssessmentStatusController",e),e.$inject=["$rootScope","$scope","$state","$stateParams","AssessmentStatusService","$ionicLoading","$ionicPopup"]}(),function(){"use strict";function e(e){e.state("assessmentStatus",{url:"/assessmentStatus",params:{planDetailsData:null},cache:!0,templateUrl:"templates/assessment/assessmentStatus/assessmentStatus.html"})}angular.module("app.assessmentStatus").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,a,o,n,i){function s(e,t){var o="/hwweb/AssignmentAssessment/findProView.action?planId="+e.planId+"&infrastructureId="+e.infraId+"&infoId="+e.id;a.getCommonData(o,t)}function r(a){o.show({template:'<div class="common-loading-dialog-center">  <ion-spinner icon="ios"></ion-spinner>&nbsp;&nbsp;  <span>数据上传中...</span></div>',duration:1e4});var s="/hwweb/AssignmentAssessment/complete.action?planId="+a.planId+"%infraId="+a.infraId;e({method:"GET",url:t.SERVER_PATH+":"+t.SERVER_PORT+s}).then(function(e){1==e.data.success&&(o.hide(),n.alert({title:"提示",template:"考核完成..."}).then(function(e){i.goBack()}))},function(e){o.hide(),n.alert({title:"失败提示",template:"上传失败，请重试！"}).then(function(e){})})}var c={getAssessmentStatusList:s,checkOverAndUpload:r};return c}angular.module("app.assessmentStatus").service("AssessmentStatusService",e),e.$inject=["$http","SYS_INFO","MyHttpService","$ionicLoading","$ionicPopup","$ionicHistory"]}(),function(){"use strict";function e(e,t,a,o,n,i,s,r,c,l){function u(){h.isEdit=n.isEdit,h.serverUrl=t.SERVER_PATH+":"+t.SERVER_PORT+"/hwweb",n.assessmentStatusData&&(h.data=n.assessmentStatusData,h.title=n.assessmentStatusData.name,console.log(h.data),h.isEdit?(g(),i.getAssessmentStatusDetailsListIsEdit(h.data,function(e){h.assessmentStatusDetails=e[0],h.assessmentStatusDetails&&(h.type=h.assessmentStatusDetails.type)})):i.getAssessmentStatusDetailsListNotEdit(h.data,function(e){h.assessmentStatusDetails=e[0],h.assessmentStatusDetails&&(h.type=h.assessmentStatusDetails.type,h.uploadData.points=h.assessmentStatusDetails.deducted,h.uploadData.reason=h.assessmentStatusDetails.dItem,h.uploadData.remarks=h.assessmentStatusDetails.remarks,h.picBase64DataArray=h.assessmentStatusDetails.imgs)}))}function p(){if(""==h.uploadData.points)r.alert({title:"扣分情况不能为空"});else if(""==h.uploadData.reason)r.alert({title:"扣分原因不能为空"});else if(""==h.uploadData.remark)r.alert({title:"备注不能为空"});else{var t={infoId:"",planId:"",infraId:"",dItemName:"",score:"",userName:"",remark:"",imgJson:[]};t.infoId=h.data.id,t.planId=h.data.planId,t.infraId=h.data.infraId,t.dItemName=h.uploadData.reason,t.score=h.uploadData.points,t.userName=e.userName,t.remark=h.uploadData.remark,t.imgJson=h.uploadPicBase64DataArray,i.uploadAssessmentStatusDetailsData(t,function(e){l.goBack()})}}function d(){if(h.picBase64DataArray.length>=3)r.alert({title:"最多支持上传三张图片"}).then(function(){});else{var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};c.getPicture(e).then(function(e){var t=moment().format("YYYY-MM-DD HH:mm:ss")+".jpg";h.picNameArray.push(t),h.picBase64DataArray.push("data:image/jpeg;base64,"+e),h.uploadPicBase64DataArray.push(e)},function(e){})}}function m(){o.go("addAssessmentMap",{mapPositionObj:h.assessmentStatusDetails,from:"assessmentStatusDetails"})}function g(){i.getAccounts(h.data,function(e){h.reasonAccount=e,h.uploadData.reason=h.reasonAccount[0].name,console.log("扣分原因数据："),console.log(h.reasonAccount)})}function f(e){h.picBase64DataArray.splice(e,1),h.uploadPicBase64DataArray.push(e,1),h.picNameArray.push(e,1)}var h=this;h.data={},h.title="",h.type="05",h.isEdit=!1,h.assessmentStatusDetails={},h.reasonAccount=[],h.picBase64DataArray=[],h.serverUrl="",h.uploadPicBase64DataArray=[],h.uploadData={points:"",reason:"",remarks:""},h.fun={uploadAssessmentStatusDetailsData:p,toCommonMap:m,takePicture:d,deletePic:f},u()}angular.module("app.assessmentStatusDetails").controller("AssessmentStatusDetailsController",e),e.$inject=["$rootScope","SYS_INFO","$scope","$state","$stateParams","AssessmentStatusDetailsService","$ionicLoading","$ionicPopup","$cordovaCamera","$ionicHistory"]}(),function(){"use strict";function e(e){e.state("assessmentStatusDetails",{url:"/assessmentStatusDetails",params:{assessmentStatusData:null,isEdit:!1},templateUrl:"templates/assessment/assessmentStatusDetails/assessmentStatusDetails.html"})}angular.module("app.assessmentStatusDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/AssignmentAssessment/findFacilities.action?typeId="+t.typeId+"&infraId="+t.infraId;e.getCommonData(o,a)}function a(t,a){var o="/hwweb/AssignmentAssessment/findFacilitiesViews.action?typeId="+t.typeId+"&infraId="+t.infraId+"&resultsId="+t.id;e.getCommonData(o,a)}function o(t,a){if(t)var o="/hwweb/AssignmentAssessment/findDItem.action?typeId="+t.typeId;else var o="/hwweb/AssignmentAssessment/findDItem.action";e.getCommonData(o,a)}function n(t,a){var o="/hwweb/AssignmentAssessment/reportPro.action",n=JSON.stringify(t);e.uploadCommonData(o,n,a)}var i={getAssessmentStatusDetailsListIsEdit:t,getAssessmentStatusDetailsListNotEdit:a,getAccounts:o,uploadAssessmentStatusDetailsData:n};return i}angular.module("app.assessmentStatusDetails").service("AssessmentStatusDetailsService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n){function i(){o.planDetailsData&&(c.data=o.planDetailsData,c.title=o.planDetailsData.planName),n.getPlanDetailsList(c.data.id,function(e){c.planDetailsList=e})}function s(){if(c.data.id){var e={id:c.data.id};a.go("addAssessment",{addAssessmentData:e})}}function r(e){e.planId=c.data.id,a.go("assessmentStatus",{planDetailsData:e})}var c=this;c.data={},c.title="",c.fun={toAddAssessment:s},c.toAssessmentStatus=r,c.planDetailsList=[],i()}angular.module("app.planDetails").controller("PlanDetailsController",e),e.$inject=["$rootScope","$scope","$state","$stateParams","PlanDetailsService"]}(),function(){"use strict";function e(e){e.state("planDetails",{url:"/assessment/planDetails",params:{planDetailsData:null},cache:!1,templateUrl:"templates/assessment/planDetails/planDetails.html"})}angular.module("app.planDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/AssignmentAssessment/findPlanView.action?planId="+t;e.getCommonData(o,a)}var a={getPlanDetailsList:t};return a}angular.module("app.planDetails").service("PlanDetailsService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s){function r(){u.map=o.initMap(),o.getCoordinateInfo(function(e){u.position=e,u.map.setZoom(15),u.marker=o.initMyPosition(u.map,e),o.getLocationByLatitudeAndLongitude(e,function(e){u.address=e}),u.map.on("click",function(e){u.marker.setPosition(e.lnglat),u.position=e.lnglat,o.getLocationByLatitudeAndLongitude(e.lnglat,function(e){u.address=e,t.$apply()}),console.log("通过在地图上选点获取到的坐标："),console.log(e.lnglat),console.log("通过在地图上选点获取的详细地址："),console.log(u.address)})})}function c(){o.getCoordinateInfo(function(e){u.position=e,u.marker.setPosition(e),u.map.setZoom(15),u.map.setCenter(e),o.getLocationByLatitudeAndLongitude(e,function(e){u.address=e})})}function l(){if(i.get("cacheGridCheckMapData"))console.log("$cacheFactory:cacheGridCheckMapData"),console.log(i.get("cacheGridCheckMapData")),i.get("cacheGridCheckMapData").destroy();else{var e=i("cacheGridCheckMapData");e.put("position",u.position),e.put("address",u.address),console.log("存储在本地的定位的相关数据："),console.log(e),s.goBack()}}var u=this;u.title="地图详情",u.map=null,u.marker=null,u.position=[],u.address="",u.fun={refreshMyPosition:c,sendPosition:l},r()}angular.module("app.gridCheckMap").controller("GridCheckMapController",e),e.$inject=["$rootScope","$scope","$stateParams","CommonMapService","$state","$cacheFactory","$ionicHistory"]}(),function(){"use strict";function e(e){e.state("gridCheckMap",{url:"/gridCheckMap",params:{mapData:null},cache:!0,templateUrl:"templates/gridCheck/gridCheckMap/gridCheckMap.html"})}angular.module("app.gridCheckMap").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(){n.savedData=e.getSavedUploadedData()}function a(e){}function o(e){}var n=this;n.title="本地内容",n.savedData={data:[{time:"2017/8/10/pm8:00",address:"山东路",points:"-1",reason:"道路不净",remark:"这是备注",img:[]},{time:"2017/8/10/pm6:00",address:"银川路",points:"-2",reason:"垃圾桶占路",remark:"这是备注",img:[]},{time:"2017/8/10/pm9:00",address:"镇江路",points:"-1",reason:"道路不净",remark:"这是备注",img:[]},{time:"2017/8/10/pm10:00",address:"江西路",points:"-2",reason:"垃圾桶占路",remark:"这是备注",img:[]}]},n.fun={uploadData:a,deleteSavedData:o},t()}angular.module("app.savedData").controller("SavedDataController",e),e.$inject=["SavedDataService"]}(),function(){"use strict";function e(e){e.state("savedData",{url:"/savedData",cache:!0,templateUrl:"templates/home/savedData/savedData.html"})}angular.module("app.savedData").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(){if(e.savedData)return e.savedData}function a(e){}function o(){}var n={getSavedUploadedData:t,uploadData:a,deleteSavedData:o};return n}angular.module("app.savedData").service("SavedDataService",e),e.$inject=["$stateParams"]}(),function(){"use strict";function e(e,t,a,o){function n(){a.msgId&&(r.msgId=a.msgId),i()}function i(){t.getMessagesByMsgId(r.msgId,function(e){e[0]&&(r.msgView=e[0].msgView[0],r.msg=e[0].msg[0])})}function s(t){var a="http://172.72.100.61:8090/hwweb/Trash/export?ids=fbe58ca3-5909-4bf4-988d-b82b5146f7cb,6792d9ac-2078-42d5-b3d0-60ac1099e1e6",n=a.split("/").pop();alert(n);var i=cordova.file.externalRootDirectory+n;alert(cordova.file.externalRootDirectory);var s=!0,r={};o.download(t,i,r,s).then(function(e){alert(JSON.stringify(e))},function(e){alert(JSON.stringify(e))},function(t){$timeout(function(){e.downloadProgress=t.loaded/t.total*100})}),console.log(cordova.file.externalApplicationStorageDirectory),console.log(cordova.file.dataDirectory),console.log(cordova.file.externalDataDirectory),console.log(cordova.file.externalRootDirectory),console.log(cordova.file.externalCacheDirectory),console.log(cordova.file.applicationStorageDirectory),console.log(cordova.file.cacheDirectory),console.log(cordova.file)}var r=this;r.title="消息详情",r.msgView={},r.msg={},r.msgId="",r.fun={downloadFile:s},n()}angular.module("app.messageContent").controller("MessageContentController",e),e.$inject=["$scope","MessageContentService","$stateParams","$cordovaFileTransfer"]}(),function(){"use strict";function e(e){e.state("messageContent",{url:"/messageContent",params:{msgId:""},templateUrl:"templates/message/messageContent/messageContent.html"})}angular.module("app.messageContent").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e){function t(t,a){var o="/hwweb/AppMessage/msgView.action?msgId=12";e.getCommonData(o,a)}var a={getMessagesByMsgId:t};return a}angular.module("app.messageContent").service("MessageContentService",e),e.$inject=["MyHttpService"]}(),function(){"use strict";function e(e,t,a,o,n,i,s){function r(){switch(a.problemItem&&(p.data=a.problemItem),a.fromWhere&&(p.fromWhere=a.fromWhere),p.fromWhere){case"waitForWork":o.getProblemDetailsData(p.data,function(e){0==e.length||(p.problemDetails=e[0]),o.getProblemFeedbackDetailsMap(p.problemDetails)});break;case"problemFeedback":p.problemDetails=a.problemItem,o.getProblemFeedbackDetailsMap(p.problemDetails);break;default:o.getProblemFeedbackDetailsMap(p.problemDetails)}}function c(){var e={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0,correctOrientation:!0};s.getPicture(e).then(function(e){var t=document.getElementById("problemFeedbackDetailsImg");t.src="data:image/jpeg;base64,"+e,p.imgPath=moment().format("YYYY-MM-DD HH:mm:ss")+".jpeg",p.uploadData.img=e},function(e){n.alert({title:"照片获取失败，请重新拍照!"})})}function l(){p.uploadData.id=p.problemDetails.id,p.uploadData.planId=p.problemDetails.planId,p.uploadData.feedbackUser=t.userName,""==p.uploadData.id||""==p.uploadData.planId||""==p.uploadData.feedbackUser?n.alert({title:"提示信息",template:"数据不全无法上传数据！"}):""!=p.uploadData.feedbackDescription&&""!=p.uploadData.img||n.confirm({title:"提示信息",template:"整改情况未填或者没有拍照，确认要上传么？"}).then(function(e){e&&o.uploadProblemFeedbackData(p.uploadData,function(e){i.goBack()})})}function u(){n.confirm({title:"提示信息",template:"确认要删除这张照片么？"}).then(function(e){if(e){p.uploadData.img="";var t=document.getElementById("problemFeedbackDetailsImg");t.src=""}})}var p=this;p.title="问题详情",p.fromWhere="",p.data={},p.problemDetails={id:"",planId:""},p.footerContent="确定",p.fun={initCamera:c,uploadProblemFeedbackData:l,deletePic:u},p.uploadData={id:"",planId:"",feedbackDescription:"",feedbackUser:"",img:""},p.imgPath="",r()}angular.module("app.problemFeedbackDetails").controller("ProblemFeedbackDetailsController",e),e.$inject=["$scope","$rootScope","$stateParams","ProblemFeedbackDetailsService","$ionicPopup","$ionicHistory","$cordovaCamera"]}(),function(){"use strict";function e(e){e.state("problemFeedbackDetails",{url:"/problemFeedbackDetails",params:{problemItem:null,fromWhere:""},templateUrl:"templates/problemFeedback/problemFeedbackDetails/problemFeedbackDetails.html"})}angular.module("app.problemFeedbackDetails").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){function a(e){console.log("问题饭详情页面的相关数据"),console.log(e);var a=t.getPositionArray(e.point);a=a.length<=0?null:a[0],console.log("问题饭详情页面设施坐标"),console.log(a);var o=new AMap.Map("problemFeedbackDetailsMap",{resizeEnable:!0,zoom:15,center:a});new AMap.Marker({position:a,map:o});o.plugin(["AMap.ToolBar"],function(){var e=new AMap.ToolBar;o.addControl(e)})}function o(t,a){var o="/hwweb/GridInspection/CheckProblemById.action?planId="+t.id;e.getCommonData(o,a)}function n(t,a){var o="/hwweb/GridInspection/UploadProblem.action",n=JSON.stringify(t);e.uploadCommonData(o,n,a)}var i={getProblemFeedbackDetailsMap:a,uploadProblemFeedbackData:n,getProblemDetailsData:o};return i}angular.module("app.problemFeedbackDetails").service("ProblemFeedbackDetailsService",e),e.$inject=["MyHttpService","AddAssessmentMapService"]}(),function(){"use strict";function e(e,t,a,o,n,i){function s(){switch(o.from?u.from=o.from:u.from="addAssessment",u.from){case"addAssessment":o.mapPositionObj&&(console.log(o.mapPositionObj),o.mapPositionObj.name&&(u.mapPositionObj.address=o.mapPositionObj.name),u.mapPositionObj.position=i.getPositionArray(o.mapPositionObj.point)),console.log(u.mapPositionObj);break;case"assessmentStatusDetails":o.mapPositionObj&&(console.log(o.mapPositionObj),u.mapPositionObj.address=o.mapPositionObj.name,u.mapPositionObj.position=i.getPositionArray(o.mapPositionObj.point)),console.log(u.mapPositionObj)}r()}function r(){if(u.map=n.initMap(),u.markerPerson=new AMap.Marker,n.getCoordinateInfo(function(e){u.markerPerson.setPosition(e),u.markerPerson.setMap(u.map)}),1==u.mapPositionObj.position.length){var e=new AMap.Icon({size:new AMap.Size(20,25),image:"../assets/global/map/marker.png",imageOffset:new AMap.Pixel(0,0)});u.marker=new AMap.Marker({position:u.mapPositionObj.position[0],icon:e}),u.marker.setMap(u.map),u.map.setCenter(u.mapPositionObj.position[0])}else u.mapPositionObj.position.length>1&&(console.log("走到这里了"),u.polyline=new AMap.Polyline({path:u.mapPositionObj.position,strokeColor:"#1C8B08",strokeWeight:5}),u.polyline.setMap(u.map),u.map.setZoom(13),u.centerPositionNum=parseInt(u.mapPositionObj.position.length/2),u.map.setCenter(u.mapPositionObj.position[u.centerPositionNum]))}function c(){n.getCoordinateInfo(function(e){u.markerPerson.setPosition(e),u.map.setZoom(13),u.markerPerson.setMap(u.map),u.map.setCenter(e)})}function l(){1==u.mapPositionObj.position.length?u.map.setCenter(u.mapPositionObj.position[0]):u.mapPositionObj.position.length>1&&u.map.setCenter(u.mapPositionObj.position[u.centerPositionNum])}var u=this;u.data={},u.title="地图详情",u.from="",u.map,u.marker,u.markerPerson,u.polyline,u.centerPositionNum=0,u.fun={refreshMyPosition:c,refreshRoadOrInstallationPosition:l},u.mapPositionObj={address:"",position:[]},s()}angular.module("app.addAssessment").controller("AddAssessmentMapController",e),e.$inject=["$rootScope","$scope","$state","$stateParams","CommonMapService","AddAssessmentMapService"]}(),function(){"use strict";function e(e){e.state("addAssessmentMap",{url:"/addAssessmentMap",params:{mapPositionObj:null,from:null},templateUrl:"templates/assessment/addAssessment/addAssessmentMap/addAssessmentMap.html"})}angular.module("app.addAssessmentMap").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(){function e(){}function t(e){var t=[];if(e&&e.indexOf(",")>=0){for(var a=e.split(","),o=0;o<a.length-1;o+=2){var n=new Array;n[0]=a[o],n[1]=a[o+1],t.push(n)}return t}return t}var a={initAddAssessmentMap:e,getPositionArray:t};return a}angular.module("app.addAssessmentMap").service("AddAssessmentMapService",e),e.$inject=[]}();